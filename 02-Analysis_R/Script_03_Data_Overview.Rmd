---
title: "Analysis Overview for WP10 Starmaze Data"
author: "Patrizia Maier"
date: "`r format(Sys.time(), '%d %B, %Y')`"
output: 
  bookdown::word_document2:
    fig_caption: yes
    global_numbering: TRUE
    number_sections: TRUE
---

# Task

Navigating a star-shaped maze environment ("Starmaze") with three goal locations.

![Map of the environment](./pics/Starmaze_Environment.jpg){width=400px}

# Sessions

*Day 2*

* Practise trials: joystick control (2 trials) and task explanation (5 trials).
* Navigation to and remembering of three goal locations. Training trials where goal is visible. Probe trials where goal is not visible with two conditions: egocentric (observer-dependent, i.e. from same starting point but without landmark cues) and allocentric (observer-independent, i.e. from new starting points) (15 trials * 3 goal locations = 45 trials).

*Day 14*

* Egocentric and allocentric probe trials (4 trials * 3 locations = 12 trials (plus 3 * simple probe trials which are not analyzed)).
* Non-navigation memory test: Recognize maze shape, recognize landmarks and goal objects, position landmarks and goal object (4 trials).

![Example view from task](./pics/Starmaze_01.png){width=500px}

![Trial order at Day 2 (45 trials)](./pics/Overview_Session1.jpg){width=500px}

![Trial order at Day 14 (15 trials)](./pics/Overview_Session2.jpg){width=500px}


```{r setup, include=FALSE, cache=FALSE}
knitr::read_chunk('Script_02_Analyzer.R')
knitr::opts_chunk$set(warning=FALSE, message=FALSE) 
options(knitr.kable.NA='')
```

```{r, load_analysis_packages, include=FALSE, cache=FALSE}
```

```{r, include=FALSE}
file_name <- "../WP10_data/WP10_results/wp10_navigation_data.RData"
load(file_name)
sm_orig <- sm_data 
sm_data <- sm_data %>% filter(exclude_trial_matlab==0)
rm(file_name)

nn_YK <- length(unique(sm_data$id[sm_data$group=="YoungKids"]))
nn_OK <- length(unique(sm_data$id[sm_data$group=="OldKids"]))
nn_AD <- length(unique(sm_data$id[sm_data$group=="YoungAdults"]))

file_name <- "../WP10_data/WP10_results/wp10_post_nav_data.RData"
load(file_name)
rm(file_name)

np_YK <- length(unique(pt_data$id[pt_data$group=="YoungKids"]))
np_OK <- length(unique(pt_data$id[pt_data$group=="OldKids"]))
np_AD <- length(unique(pt_data$id[pt_data$group=="YoungAdults"]))
```

```{r, data_prep, include=FALSE}
```

```{r, plot_settings, include=FALSE}
```

```{r, analysis_settings, include=FALSE}
```

```{r, papaja_output_helper, include=FALSE}
```


# Sample
Cross-sectional comparison between

* Young kids (6-7 yrs, n = `r nn_YK`, non-navigational n = `r np_YK`) 
* Older kids (9-10 yrs, n = `r nn_OK`, non-navigational n = `r np_OK`)
* Young adults (18-35 yrs, n = `r nn_AD`, non-navigational n = `r np_AD`)

```{r, include=FALSE}
rm(nn_YK, nn_OK, nn_AD, np_YK, np_OK, np_AD)
```


# Variables of interest

In training trials, the goal is visible, i.e. the trial is always completed successfully. In probe trials, the goal is not visible. Participants go to the place where they remember the goal being located and press a button. 

*Memory accuracy*: 

* **Memory score** (metric): Euclidean distance between x-/y-coordinates of the remembered and the correct goal location. Memory score normalizes the Euclidean distance value as a score from 0 to 1 (chance level 0.5) by comparing final distance to the final distance of 1000 randomly sampled locations within the maze (Jacobs 2016; Bellmund 2019)
$$\text{Euclidean distance} = \sqrt{(x_{correct}-x_{remembered})^2 + (y_{correct}-y_{remembered})^2}$$
$$\text{Memory score} = \text{percentile rank of the Euclidean distance value on random distribution}$$
* **Correct trial** (yes/no): Finding the correct goal alley, defined as the correct outer alley or intersection right in front.

*Navigation behavior*: 

* **Time**: Time to complete the trial in seconds.
* **Excess path length** (metric): This measure reflects how directly participants navigated to the remembered goal location (Suthana 2012; Jacobs 2016; Bellmund 2019). It is calculated as the travelled path length minus the ideal path length to the remembered location. The path lengths are calculated as summation of Euclidean distances between x-/y-coordinates over time. 
$$\text{(Ideal) path length} = \sum_{i=1}^{n} \sqrt{(x_{i}-x_{i+1})^2 + (y_{i}-y_{i+1})^2}$$
$$\text{Excess path length} = (path-path_{ideal})$$
* **Excess distance to goal** (metric): This measure reflects if participants searched further away from or near the correct goal location (Maei et al., 2009). It is calculated as the avg. distance to goal minus the ideal avg. distance to goal to the goal location. The distance to goal is calculated as the cumulative Euclidean distance between the the playerâ€™s x-/y-coordinates along their path and the correct goal location, averaged by the number of x-/y data points. 
$$\text{(Ideal) distance to goal} = \frac {\sum_{i=1}^{n}\sqrt{(x_{i}-x_{correct})^2 + (y_{i}-y_{correct})^2}} {n}$$
$$\text{Excess distance to goal} = (distance-distance_{ideal})$$
* **Initial rotation velocity** (metric): A modified version of the integrated absolute angular velocity (IdPhi, also called vicarious-trial-and-error (VTE) behavior, Papale et al., 2012; Santos-Pata et al., 2018; Hasz & Redish, 2020; Miles et al., 2021). This value indicates the degree of deliberation and visual exploration at the first decision point of the trial and has been associated with allocentric strategy use and spatial conflict resolution (Schmidt et al., 2013; Jeung, Iggena et al., 2023). We used the z-rotation data from the beginning of the trial up until when the participant left the first intersection. The z-rotation raw data was transformed from degrees to radians and unwrapped (to avoid circular transitions when calculating change). Then, we computed the summation of absolute change in rotation across the initial segment, divided by the number of data points to obtain velocity.
$$\text{Initial rotation Velocity} = \frac {\sum_{i=1}^{n_{initial}} | (z_{i}-z_{i+1})|} {n_{initial}}$$

![Visualization of variables of interest](./pics/Var_all.jpg){width=300px,height=500x}  


# Statistical analysis

All linear mixed models (LMM) were computed using the mixed() function from the afex package (Singmann et al., 2022), which is based on lmer() from the lme4 package (Bates et al., 2015). We used the maximum random effects structure as recommended by Barr (2013) and simplified according to Bates et al. (2015) and Matuschek et al. (2017) in case of non-convergence. The diagnostic plots showed non-normality, outliers and heteroscedastic variances (especially larger variance in children compared to adults). To account for this, we computed additional models 1. excluding outliers (defined as above/below the upper/lower quantile plus/minus 1.5 * IQR, similar to Bellmund et al., 2019) and 2. models with heterogeneous variances with lme() from the nlme package (Pinheiro & Bates, 2022). The results did not change substantially, which is why we decided to use the most simple LMM approach. 

For evaluating the general fit, we calculated a (pseudo) R^2^ for each model according to Nakagawa and Schielzeth's (2013) approach with the r2beta() function from the r2glmm package (Jaeger, 2017). However, R^2^ for LMM should be interpreted with caution and do not directly correspond to a traditional R^2^. We computed degrees of freedom for the LMM with Sattherthwaite's method using the lmerTest package (Kuznetsova et al., 2017; via afex package). For all significant main effects and interactions, we computed post-hoc planned contrasts with the emmeans package (Lenth, 2022), using Bonferroni-corrections for multiple comparisons.

Single-trial values were analyzed with ANOVAs from the afex package (Singmann et al., 2022). 

\newpage

# Results 

## Memory accuracy: Probe trials at Day 2 & Day 14

```{r, plot_raw_dots, include=F }
```

```{r,echo=F, fig.height=5, fig.cap="Responses for egocentric probe." }
dots_ego 
rm(dots_ego)
```

```{r,echo=F, fig.height=5, fig.cap="Responses for allocentric probe." }
dots_allo 
rm(dots_allo)
```

\newpage 

### **Memory score (all probe trials)**

```{r, model_probe_ms }
```

```{r, post_hoc_probe_ms }
```

```{r, plot_probe_ms, include=F }
```

```{r, echo=F, fig.height=5, fig.width=5, fig.cap="Memory score for probe trials." }
plot.ms
rm(plot.ms)
```

```{r apa_probe_ms, include=F}
R2 <- r2beta(model.ms$full_model, method='nsj', partial=F) %>% mutate_all(apa_num)

apa_lmm.ms <- apa_print(model.ms)

apa_post.ms_group <- post.ms_group %>%  apa_print() %>% bonferroni_fix()
apa_post.ms_group_chance <- post.ms_group_chance %>%  apa_print() %>% bonferroni_fix()

apa_post.ms_condition <- post.ms_condition %>%  apa_print()

apa_post.ms_session <- post.ms_session %>%  apa_print()

rm(post.ms_group, post.ms_group_chance, post.ms_condition, post.ms_session)
```

(ref:p-ms-f-caption0) Fixed effects for memory score in probe.

```{r table-probe-ms-f0, echo=F}
apa_table(
  apa_lmm.ms$table, 
  caption="(ref:p-ms-f-caption0)",
  placement="h")
```

(ref:p-ms-r-caption0) Random effects for memory score in probe.

```{r table-probe-ms-r0, echo=F}
apa_random_table(VarCorr(model.ms$full_model)) %>% 
  knitr::kable(
    caption="(ref:p-ms-r-caption0)")
```

The model had a fit of $R2 = `r R2$Rsq`, [CI: `r R2$upper.CL`, `r R2$lower.CL`$].

We found significant main effects of *age group* (`r apa_lmm.ms$statistic$group`), *condition* (`r apa_lmm.ms$statistic$condition`), and *session* (`r apa_lmm.ms$statistic$session`) for the memory score in probe trials, but no significant two-way or three-way interactions (Table\ \@ref(tab:table-probe-ms-f0)). All age groups performed significantly above chance level (test against chance level for 6-7-yo: `r apa_post.ms_group_chance$statistic$YoungKids`; 9-10-yo: `r apa_post.ms_group_chance$statistic$OldKids`; adults: `r apa_post.ms_group_chance$statistic$YoungAdults`) and there was a gradual increase in memory with increasing age (6-7-yo vs. 9-10-yo `r apa_post.ms_group$statistic$YoungKids_OldKids`; 6-7-yo vs. adults `r apa_post.ms_group$statistic$YoungKids_YoungAdults`; 9-10-yo vs. adults `r apa_post.ms_group$statistic$OldKids_YoungAdults`). The memory score was slightly higher in the egocentric than the allocentric condition (`r apa_post.ms_condition$full_result`) and spatial memory deteriorated significantly over the 2-week period between the sessions (`r apa_post.ms_session$full_result`). 

[OPTIONAL, MAYBE CIRCULAR LOGIC] The random effects can give us additional insights into the data, specifically the correlations between the intercepts and the random slopes for session and for condition. There was a negative correlation between intercepts and the session slope. As the session effect was negative (decline of memory across sessions), this means that individuals with lower average performance had stronger decline across session. Likewise, there was a negative correlation between intercepts and the condition slope. Condition was coded with egocentric as first and allocentric as second level and the condition effect was negative (i.e. egocentric better than allocentric). This means that individuals with lower average performance showed stronger performance difference between conditions. 

```{r, include=F}
rm(model.ms, R2, apa_lmm.ms, apa_post.ms_group, apa_post.ms_group_chance, apa_post.ms_condition, apa_post.ms_session)
```


## Memory accuracy: Non-navigational memory tasks at Day 14

![Task overview](./pics/Overview_Session2_PostTest.jpg){width=500px}

```{r, model_post_layout, include=F }
```

```{r, plot_post_layout, include=F }
```

```{r, model_post_landmark, include=F }
```

```{r, plot_post_landmark, include=F }
```

```{r, model_post_position, include=F }
```

```{r, plot_post_position, include=F }
```

```{r, echo=F, fig.height=5, fig.width=8, fig.cap="Scores in non-navigational memory tests." }
plot.layout + 
  (plot.landmark + guides(color="none", shape="none")) + 
  (plot.position + guides(color="none", shape="none")) + 
  plot_annotation(title="Non-navigational memory tests") +
  plot_layout(guides="collect") & theme(legend.position="bottom", legend.justification=c(0,0))

rm(plot.layout, plot.layout_detailed, plot.landmark, plot.position)
```

### **Layout**

```{r apa_layout, include=F}
apa_fisher.layout <- model.layout %>% pluck("p.value") %>% apa_p(add_equals=T)

apa_post.layout_young_vs_old <- post.layout$p.adj[1] %>% apa_p(add_equals=T)
apa_post.layout_young_vs_adult <- post.layout$p.adj[2] %>% apa_p(add_equals=T)
apa_post.layout_old_vs_adult <- post.layout$p.adj[3] %>% apa_p(add_equals=T)
rm(post.layout)
```

We found significant *age-related group* differences in the ability to correctly identify the maze layout (Fisher's exact test $p$ `r apa_fisher.layout`). Post-hoc contrasts showed that all age groups differed significantly from each other and that there was a gradual increase in performance with increasing age (Bonferroni-adjusted pairwise Fisher test: 6-7-yo vs. 9-10-yo $p$ `r apa_post.layout_young_vs_old`; 6-7-yo vs. adults $p$ `r apa_post.layout_young_vs_adult`; 9-10-yo vs. adults $p$ `r apa_post.layout_old_vs_adult`).

```{r, include=F}
rm(model.layout, apa_fisher.layout, apa_post.layout_young_vs_old, apa_post.layout_young_vs_adult, apa_post.layout_old_vs_adult)
```

### **Landmarks**

```{r apa_landmark, include=F}
apa_aov.landmark <- apa_print(model.landmark)
```

There were no significant *age-related group* in the ability to correctly identify the landmarks (`r apa_aov.landmark$statistic$group`). 

```{r, include=F}
rm(model.landmark, apa_aov.landmark)
```

### **Positioning**

```{r apa_position, include=F}
apa_aov.position <- apa_print(model.position)

apa_post.position <- post.position$contrasts %>% apa_print() %>% bonferroni_fix()
rm(post.position)
```

There were significant *age-related group* differences in the ability to correctly position the landmarks and goal locations in a 2D map (`r apa_aov.position$statistic$group`). Post-hoc contrasts showed that adults performed significantly better than both groups of children (6-7-yo vs. adults `r apa_post.position$statistic$YoungKids_YoungAdults`; 9-10-yo vs. adults `r apa_post.position$statistic$OldKids_YoungAdults`) but that the children groups did not differ (6-7-yo vs. 9-10-yo `r apa_post.position$statistic$YoungKids_OldKids`). 

```{r, include=F}
rm(model.position, apa_aov.position, apa_post.position)
```

## Navigation behaviour: Probe trials at Day 2 & Day 14

### **Time**

```{r, model_probe_time}
```

```{r, post_hoc_probe_time, include=F }
```

```{r, plot_probe_time, include=F }
```

```{r, echo=F, fig.height=5, fig.width=5, fig.cap="Time in probe trials." }
plot.time
rm(plot.time)
```

```{r apa_probe_time, include=F}
R2 <- r2beta(model.time$full_model, method='nsj', partial=F) %>% mutate_all(apa_num)

apa_lmm.time  <- apa_print(model.time)

apa_post.time_group_session <- post.time_group_session %>% apa_print() %>% bonferroni_fix()

apa_post.time_group_condition <- post.time_group_condition %>% apa_print() %>% bonferroni_fix()

apa_post.time_session_condition <- post.time_session_condition %>% apa_print() %>% bonferroni_fix()

rm(post.time_group_session, post.time_group_condition, post.time_session_condition)
```

(ref:p-t-f-caption0) Fixed effects for time in probe trials.

```{r table-probe-time-f0, echo=F}
apa_table(
  apa_lmm.time$table,
  caption="(ref:p-t-f-caption0)",
  placement="h")
```

(ref:p-t-r-caption0) Random effects for time in probe trials.

```{r table-probe-time-r0, echo=F}
apa_random_table(VarCorr(model.time$full_model)) %>% 
  knitr::kable(
    caption="(ref:p-t-r-caption0)")
```

The model had a fit of $R2 = `r R2$Rsq`, [CI: `r R2$upper.CL`, `r R2$lower.CL`$].

For time in probe trials, all two-way interactions were significant (Table\ \@ref(tab:table-probe-time-f0)). Post-hoc contrasts on the *group x session* interaction (`r apa_lmm.time$statistic$group_session`) showed that 6-7-yo children required significantly more time than adults in the first session only (`r apa_post.time_group_session$statistic$X1_YoungKids_YoungAdults`), no other comparisons across age groups and sessions were significant. Post-hoc contrasts on the *group x condition* interaction (`r apa_lmm.time$statistic$group_condition`) revealed that 6-7-yo children required significantly more time than adults in the allocentric condition only (`r apa_post.time_group_condition$statistic$Alloret_YoungKids_YoungAdults`) and that participants generally needed less time to complete the egocentric than the allocentric condition (egocentric vs. allocentric in 6-7-yo  `r apa_post.time_group_condition$statistic$YoungKids_Egoret_alloret`; 9-10-yo `r apa_post.time_group_condition$statistic$OldKids_Egoret_alloret`; adults `r apa_post.time_group_condition$statistic$YoungAdults_Egoret_alloret`). The *session x condition* interaction (`r apa_lmm.time$statistic$session_condition`) added that this age-independent time increase for the allocentric condition was present in both sessions (egocentric vs. allocentric in first session `r apa_post.time_session_condition$statistic$X1_Egoret_alloret`; second session `r apa_post.time_session_condition$statistic$X2_Egoret_alloret`). Time per trial did not change across sessions. 

```{r table-probe-time1, echo=F}
apa_table(
  apa_post.time_group_session$table %>% remove_rownames(),
  placement="h")
```

```{r table-probe-time2, echo=F}
apa_table(
  apa_post.time_group_condition$table %>% remove_rownames(),
  placement="h")
```

```{r table-probe-time3, echo=F}
apa_table(
  apa_post.time_session_condition$table %>% remove_rownames(),
  placement="h")
```

```{r, include=F}
rm(model.time, R2, apa_lmm.time, apa_post.time_group_session, apa_post.time_group_condition, apa_post.time_session_condition)
```

\newpage 

### **Excess path length**

```{r, model_probe_path }
```

```{r, post_hoc_probe_path, include=F }
```

```{r, plot_probe_path, include=F }
```

```{r, echo=F, fig.height=5, fig.width=5, fig.cap="Excess path length in probe trials." }
plot.path
rm(plot.path)
```

```{r apa_probe_path, include=F}
R2 <- r2beta(model.path$full_model, method='nsj', partial=F) %>% mutate_all(apa_num)

apa_lmm.path <- apa_print(model.path)

apa_post.path_group_session <- post.path_group_session %>% apa_print() %>% bonferroni_fix()

apa_post.path_group_condition <- post.path_group_condition %>% apa_print() %>% bonferroni_fix()

apa_post.path_session_condition <- post.path_session_condition %>% apa_print() %>% bonferroni_fix()

rm(post.path_group_session, post.path_group_condition, post.path_session_condition)
```

(ref:p-ep-f-caption0) Fixed effects for excess path in probe trials.

```{r table-probe-excess-path-f0, echo=F}
apa_table(
  apa_lmm.path$table,
  caption="(ref:p-ep-caption0)",
  placement="h")
```

(ref:p-ep-r-caption0) Random effects for excess path in probe trials.

```{r table-probe-excess-path-r0, echo=F}
apa_random_table(VarCorr(model.path$full_model)) %>% 
  knitr::kable(
    caption="(ref:p-ep-r-caption0)")
```

The model had a fit of $R2 = `r R2$Rsq`, [CI: `r R2$upper.CL`, `r R2$lower.CL`$].

For excess path length in probe trials, all two-way interactions were significant (Table\ \@ref(tab:table-probe-excess-path-f0)). Post-hoc contrasts on the *group x session* interaction (`r apa_lmm.path$statistic$group_session`) showed an age-dependent decreased excess path length with increasing age for the first session (6-7-yo vs. 9-10-yo `r apa_post.path_group_session$statistic$X1_YoungKids_OldKids`; 6-7-yo vs. adults `r apa_post.path_group_session$statistic$X1_YoungKids_YoungAdults`; 9-10-yo vs. adults `r apa_post.path_group_session$statistic$X1_OldKids_YoungAdults`), in the second session only the comparisons between children and adults were significant (6-7-yo vs. adults `r apa_post.path_group_session$statistic$X2_YoungKids_YoungAdults`; 9-10-yo vs. adults `r apa_post.path_group_session$statistic$X2_OldKids_YoungAdults`). Post-hoc contrasts on the *group x condition* interaction revealed than adults had significantly longer excess paths than 6-7-yo children in the egocentric condition (`r apa_post.path_group_condition$statistic$Egoret_YoungKids_YoungAdults`) and significantly longer excess paths than both groups of children in the allocentric condition (6-7-yo vs. adults `r apa_post.path_group_condition$statistic$Alloret_YoungKids_YoungAdults`; 9-10-yo vs. adults `r apa_post.path_group_condition$statistic$Alloret_OldKids_YoungAdults`). Participants generally had shorter excess path lengths in the egocentric than the allocentric condition (egocentric vs. allocentric in 6-7-yo  `r apa_post.path_group_condition$statistic$YoungKids_Egoret_alloret`; 9-10-yo `r apa_post.path_group_condition$statistic$OldKids_Egoret_alloret`; adults `r apa_post.path_group_condition$statistic$YoungAdults_Egoret_alloret`). The *session x condition* interaction (`r apa_lmm.path$statistic$session_condition`) added that this age-independent increase in excess path length for the allocentric condition was present in both sessions (egocentric vs. allocentric in first session `r apa_post.path_session_condition$statistic$X1_Egoret_alloret`; second session `r apa_post.path_session_condition$statistic$X2_Egoret_alloret`). Excess path length did not change across sessions. 

```{r table-probe-excess-path1, echo=F}
apa_table(
  apa_post.path_group_session$table %>% remove_rownames(),
  placement="h")
```

```{r table-probe-excess-path2, echo=F}
apa_table(
  apa_post.path_group_condition$table %>% remove_rownames(),
  placement="h")
```

```{r table-probe-excess-path3, echo=F}
apa_table(
  apa_post.path_session_condition$table %>% remove_rownames(),
  placement="h")
```

```{r, include=F}
rm(model.path, apa_lmm.path, apa_post.path_group_session, apa_post.path_group_condition, apa_post.path_session_condition)
```

\newpage 

### **Excess distance to goal**

```{r, model_probe_target_distance }
```

```{r, post_hoc_probe_target_distance, include=F }
```

```{r, plot_probe_target_distance, include=F }
```

```{r, echo=F, fig.height=5, fig.width=5, fig.cap="Excess distance to goal in probe trials." }
plot.target_distance
rm(plot.target_distance)
```

```{r apa_probe_target_distance, include=F}
R2 <- r2beta(model.target_distance$full_model, method='nsj', partial=F) %>% mutate_all(apa_num)

apa_lmm.distance <- apa_print(model.target_distance)

apa_post.distance_group <- post.distance_group %>% apa_print() %>% bonferroni_fix()

apa_post.distance_session <- post.distance_session %>% apa_print()

apa_post.distance_condition <- post.distance_condition %>% apa_print()

rm(post.distance_group, post.distance_session, post.distance_condition)
```

(ref:p-ed-caption-f0) Fixed effects for excess distance to goal in probe trials.

```{r table-probe-excess-distance-f0, echo=F}
apa_table(
  apa_lmm.distance$table,
  caption="(ref:p-ed-caption-f0)",
  placement="h")
```

(ref:p-ed-r-caption-r0) Random effects for excess distance to goal in probe trials.

```{r table-probe-excess-distance-r0, echo=F}
apa_random_table(VarCorr(model.target_distance$full_model)) %>% 
  knitr::kable(
    caption="(ref:p-ed-r-caption-r0)")
```

The model had a fit of $R2 = `r R2$Rsq`, [CI: `r R2$upper.CL`, `r R2$lower.CL`$].

We found significant main effects of *age group* (`r apa_lmm.distance$statistic$group`), *condition* (`r apa_lmm.distance$statistic$condition`), and *session* (`r apa_lmm.distance$statistic$session`) for excess distance to goal in probe trials, but no significant two-way or three-way interactions (Table\ \@ref(tab:table-probe-excess-distance-f0)). There was a general age-related decrease in excess distance to goal with increasing age (6-7-yo vs. 9-10-yo `r apa_post.distance_group$statistic$YoungKids_OldKids`; 6-7-yo vs. adults `r apa_post.distance_group$statistic$YoungKids_YoungAdults`; 9-10-yo vs. adults `r apa_post.distance_group$statistic$OldKids_YoungAdults`). Excess distance to goal was significantly higher in the allocentric than egocentric condition (`r apa_post.distance_condition$full_result`) and increased significantly over the 2-week period between sessions (`r apa_post.distance_session$full_result`). 

```{r, include=F}
rm(model.target_distance, apa_lmm.distance, apa_post.distance_group, apa_post.distance_session, apa_post.distance_condition)
```

\newpage 

### **Initial rotation**

```{r, model_probe_rotation }
```

```{r, post_hoc_probe_rotation, include=F}
```

```{r, plot_probe_rotation, include=F }
```

```{r, echo=F, fig.height=5, fig.width=5, fig.cap="Initial rotation in probe trials." }
plot.rotation
rm(plot.rotation)
```

```{r apa_probe_rotation, include=F}
R2 <- r2beta(model.rotation$full_model, method='nsj', partial=F) %>% mutate_all(apa_num)

apa_lmm.init_rot <- apa_print(model.rotation)

apa_post.init_rot_group_session <- post.init_rot_group_session %>% apa_print() %>% bonferroni_fix()

apa_post.init_rot_group_condition <- post.init_rot_group_condition %>% apa_print() %>% bonferroni_fix()

apa_post.init_rot_session_condition <- post.init_rot_session_condition %>% apa_print() %>% bonferroni_fix()

rm(post.init_rot_group_session, post.init_rot_group_condition, post.init_rot_session_condition)
```

(ref:p-init-rot-caption-f0) Fixed effects for initial rotation in probe trials.

```{r table-probe-init-rot-f0, echo=F}
apa_table(
  apa_lmm.init_rot$table,
  caption="(ref:p-init-rot-caption-f0)",
  placement="h")
```

(ref:p-init-rot-r-caption-r0) Random effects for initial rotation in probe trials.

```{r table-probe-init-rot-r0, echo=F}
apa_random_table(VarCorr(model.rotation$full_model)) %>% 
  knitr::kable(
    caption="(ref:p-init-rot-r-caption-r0)")
```

The model had a fit of $R2 = `r R2$Rsq`, [CI: `r R2$upper.CL`, `r R2$lower.CL`$].

For initial rotation in probe trials, all two-way interactions were significant (Table\ \@ref(tab:table-probe-init-rot-f0)). Post-hoc contrasts on the *group x session* interaction (`r apa_lmm.init_rot$statistic$group_session`) revealed that initial rotation increased across sessions for 6-7-yo children (`r apa_post.init_rot_group_session$statistic$YoungKids_Session1_session2`) and adults only (`r apa_post.init_rot_group_session$statistic$YoungAdults_Session1_session2`). There were no significant age group differences within sessions. Post-hoc contrasts on the *group x condition* interaction (`r apa_lmm.init_rot$statistic$group_condition`) found that initial rotation was increase in the allocentric compared to egocentric condition for all age groups (egocentric vs. allocentric for 6-7-yo `r apa_post.init_rot_group_condition$statistic$YoungKids_Egoret_alloret`; 9-10-yo `r apa_post.init_rot_group_condition$statistic$OldKids_Egoret_alloret`; adults `r apa_post.init_rot_group_condition$statistic$YoungAdults_Egoret_alloret`). There were no significant age group differences within conditions. The *session x condition* interaction (`r apa_lmm.init_rot$statistic$session_condition`) added that the age-independent increase in initial rotation for the allocentric condition was present in both sessions (egocentric vs. allocentric in first session `r apa_post.init_rot_session_condition$statistic$X1_Egoret_alloret`; second session `r apa_post.init_rot_session_condition$statistic$X2_Egoret_alloret`) and that initial rotation increased across sessions only in the allocentric (`r apa_post.init_rot_session_condition$statistic$Alloret_Session1_session2`) but not egocentric condition. 

```{r table-probe-init-rot1, echo=F}
apa_table(
  apa_post.init_rot_group_session$table %>% remove_rownames(),
  placement="h")
```

```{r table-probe-init-rot2, echo=F}
apa_table(
  apa_post.init_rot_group_condition$table %>% remove_rownames(),
  placement="h")
```

```{r table-probe-init-rot3, echo=F}
apa_table(
  apa_post.init_rot_session_condition$table %>% remove_rownames(),
  placement="h")
```

```{r, include=F}
rm(model.rotation, apa_lmm.init_rot, apa_post.init_rot_group_session, apa_post.init_rot_group_condition, apa_post.init_rot_session_condition)
```

\newpage 

### **Initial rotation velocity**

```{r, model_probe_rotation_velocity }
```

```{r, post_hoc_probe_rotation_velocity, include=F }
```

```{r, plot_probe_rotation_velocity, include=F }
```

```{r, echo=F, fig.height=5, fig.width=5, fig.cap="Initial rotation velocity in probe trials." }
plot.rotation_velocity
rm(plot.rotation_velocity)
```

```{r apa_probe_rotation_velocity, include=F }
R2 <- r2beta(model.rotation_velocity$full_model, method='nsj', partial=F) %>% mutate_all(apa_num)

apa_lmm.init_vel <- apa_print(model.rotation_velocity)

apa_post.init_vel_group_condition <- post.init_vel_group_condition %>% apa_print() %>% bonferroni_fix()

apa_post.init_vel_session_condition <- post.init_vel_session_condition %>% apa_print() %>% bonferroni_fix()

rm(post.init_vel_group_condition, post.init_vel_session_condition)
```

(ref:p-init-vel-f-caption0) Fixed effects for initial rotation veloctiy in probe trials.

```{r table-probe-init-vel-f0, echo=F}
apa_table(
  apa_lmm.init_vel$table,
  caption="(ref:p-init-vel-f-caption0)",
  placement="h")
```

(ref:p-init-vel-r-caption-r0) Random effects for initial rotation veloctiy in probe trials.

```{r table-probe-init-vel-r0, echo=F}
apa_random_table(VarCorr(model.rotation_velocity$full_model)) %>% 
  knitr::kable(
    caption="(ref:p-init-vel-r-caption-r0)")
```

The model had a fit of $R2 = `r R2$Rsq`, [CI: `r R2$upper.CL`, `r R2$lower.CL`$].

For initial rotation velocity in probe trials, we found two significant two-way interactions (Table\ \@ref(tab:table-probe-init-vel-f0)). Post-hoc contrasts for the *group x session* interaction (`r apa_lmm.init_vel$statistic$group_condition`) showed significant age group differences only in the allocentric condition, where 6-7-yo children had a significantly lower initial rotation velocity than both 9-10-yo (`r apa_post.init_vel_group_condition$statistic$Alloret_YoungKids_OldKids`) and adults (`r apa_post.init_vel_group_condition$statistic$Alloret_YoungKids_YoungAdults`). All groups had significantly higher initial rotation velocity for the allocentric than egocentric condition (6-7-yo `r apa_post.init_vel_group_condition$statistic$YoungKids_Egoret_alloret`; 9-10-yo `r apa_post.init_vel_group_condition$statistic$OldKids_Egoret_alloret`; adults `r apa_post.init_vel_group_condition$statistic$YoungAdults_Egoret_alloret`). The *session x condition* interaction (`r apa_lmm.init_vel$statistic$session_condition`) added that this age-independent increase in initial rotation velocity for the allocentric condition was present in both sessions (egocentric vs. allocentric in first session `r apa_post.init_vel_session_condition$statistic$X1_Egoret_alloret`; second session `r apa_post.init_vel_session_condition$statistic$X2_Egoret_alloret`) and that initial rotation velocity increased across sessions only in the allocentric (`r apa_post.init_vel_session_condition$statistic$Alloret_Session1_session2`) but not egocentric condition. 

```{r table-probe-init-vel2, echo=F}
apa_table(
  apa_post.init_vel_group_condition$table %>% remove_rownames(),
  placement="h")
```

```{r table-probe-init-vel3, echo=F}
apa_table(
  apa_post.init_vel_session_condition$table %>% remove_rownames(),
  placement="h")
```

```{r, include=F}
rm(model.rotation_velocity, apa_lmm.init_vel, apa_post.init_vel_group_condition, apa_post.init_vel_session_condition)
```

\newpage 

## Supplementary material 

### Navigation behavior: Training trials at Day 2 

#### **Time**

```{r, model_learn_time}
```

```{r, post_hoc_learn_time, include=F}
```

```{r, plot_learn_time, include=F}
```

```{r, echo=F, fig.height=4, fig.width=5, fig.cap="Trial curve for time in training." }
plot.time_learn 
rm(plot.time_learn)
```

```{r apa_learn_time, include=F}
R2 <- r2beta(model.time_learn$full_model, method='nsj', partial=F) %>% mutate_all(apa_num)

apa_lmm.learn_time <- apa_print(model.time_learn)

apa_post.learn_time_group <- post.learn_time_group %>% apa_print() %>% bonferroni_fix()

apa_post.learn_time_trial <- post.learn_time_trial %>% apa_print() %>% bonferroni_fix()

rm(post.learn_time_group, post.learn_time_trial)
```

(ref:l-t-caption-f0) Fixed effects for time in training.

```{r table-learn-time-f0, echo=F}
apa_table(
  apa_lmm.learn_time$table,
  caption="(ref:l-t-caption-f0)",
  placement="h")
```

(ref:l-t-caption-r0) Random effects for time in training.

```{r table-learn-time-r0, echo=F}
apa_random_table(VarCorr(model.time_learn$full_model)) %>% 
  knitr::kable(
    caption="(ref:l-t-caption-r0)")
```

The model had a fit of $R2 = `r R2$Rsq`, [CI: `r R2$upper.CL`, `r R2$lower.CL`$].

There was a main effect of *group* (`r apa_lmm.learn_time$statistic$group`), showing that 6-7-yo children required significantly more time than 9-10-yo children (`r apa_post.learn_time_group$statistic$YoungKids_OldKids`) and adults (`r  apa_post.learn_time_group$statistic$YoungKids_YoungAdults`). There was a main effect of *trial in block* (`r apa_lmm.learn_time$statistic$trial_in_block`). Here time in the first trial per block was significantly higher than in all other trials. 
(Table\ \@ref(tab:table-learn-time-f0))

```{r, include=F}
rm(model.time_learn, R2, apa_lmm.learn_time, apa_post.learn_time_group, apa_post.learn_time_trial)
```

\newpage

#### **Excess path length**

```{r, model_learn_path }
```

```{r, post_hoc_learn_path, include=F}
```

```{r, plot_learn_path, include=F}
```

```{r, echo=F, fig.height=4, fig.width=5, fig.cap="Trial curve for excess path length in training." }
plot.path_learn
rm(plot.path_learn)
```

```{r apa_learn_path, include=F}
R2 <- r2beta(model.path_learn$full_model, method='nsj', partial=F) %>% mutate_all(apa_num)

apa_lmm.learn_path <- apa_print(model.path_learn)

apa_post.learn_path_group <- post.learn_path_group %>% apa_print() %>% bonferroni_fix()

apa_post.learn_path_trial <- post.learn_path_trial %>% apa_print() %>% bonferroni_fix()

rm(post.learn_path_group, post.learn_path_trial)
```

(ref:l-ep-caption-f0) Fixed effects for excess path length in training.

```{r table-learn-excess-path-f0, echo=F}
apa_table(
  apa_lmm.learn_path$table,
  caption="(ref:l-ep-caption-f0)",
  placement="h")
```

(ref:l-ep-caption-r0) Random effects for excess path length in training.

```{r table-learn-excess-path-r0, echo=F}
apa_random_table(VarCorr(model.path_learn$full_model)) %>% 
  knitr::kable(
    caption="(ref:l-ep-caption-r0)")
```

The model had a fit of $R2 = `r R2$Rsq`, [CI: `r R2$upper.CL`, `r R2$lower.CL`$].

There was a main effect of *group* (`r apa_lmm.learn_path$statistic$group`), showing a gradual decrease in excess path length with increasing age (6-7-yo vs. 9-10-yo `r apa_post.learn_path_group$statistic$YoungKids_OldKids`; 6-7-yo vs. adults `r apa_post.learn_path_group$statistic$YoungKids_YoungAdults`; 9-10-yo vs. adults `r apa_post.learn_path_group$statistic$OldKids_YoungAdults`). There was a main effect of *trial in block* (`r apa_lmm.learn_path$statistic$trial_in_block`). Here excess path length in the first trial per block was significantly higher than in all other trials. (Table\ \@ref(tab:table-learn-excess-path-f0))

```{r, include=F}
rm(model.path_learn, R2, apa_lmm.learn_path, apa_post.learn_path_group, apa_post.learn_path_trial)
```

\newpage

#### **Excess distance to goal**

```{r, model_learn_target_distance }
```

```{r, post_hoc_learn_target_distance, include=F}
```

```{r, plot_learn_target_distance, include=F}
```

```{r, echo=F, fig.height=4, fig.width=5, fig.cap="Trial curve for excess distance to goal in training." }
plot.target_distance_learn
rm(plot.target_distance_learn)
```

```{r apa_learn_target_distance, include=F}
R2 <- r2beta(model.target_distance_learn$full_model, method='nsj', partial=F) %>% mutate_all(apa_num)

apa_lmm.learn_distance <- apa_print(model.target_distance_learn)

apa_post.learn_distance_group <- post.learn_distance_group %>% apa_print() %>% bonferroni_fix()

apa_post.learn_distance_trial <- post.learn_distance_trial %>% apa_print() %>% bonferroni_fix()

rm(post.learn_distance_group, post.learn_distance_trial)
```

(ref:l-ed-caption-f0) Fixed effects for excess distance to goal in training.

```{r table-learn-excess-distance-f0, echo=F}
apa_table(
  apa_lmm.learn_distance$table,
  caption="(ref:l-ed-caption-f0)",
  placement="h")
```

(ref:l-ed-caption-r0) Random effects for excess distance to goal in training.

```{r table-learn-excess-distance-r0, echo=F}
apa_random_table(VarCorr(model.target_distance_learn$full_model)) %>% 
  knitr::kable(
    caption="(ref:l-ed-caption-r0)")
```

The model had a fit of $R2 = `r R2$Rsq`, [CI: `r R2$upper.CL`, `r R2$lower.CL`$].

There was a main effect of *group* (`r apa_lmm.learn_distance$statistic$group`), showing that 6-7-yo children had a significantly higher excess distance to the goal than 9-10-yo children (`r apa_post.learn_distance_group$statistic$YoungKids_OldKids`) and adults (`r  apa_post.learn_distance_group$statistic$YoungKids_YoungAdults`). There was a main effect of *trial in block* (`r apa_lmm.learn_distance$statistic$trial_in_block`). Here excess distance to the goal in the first trial per block was significantly higher than in all the other trials. 
(Table\ \@ref(tab:table-learn-excess-distance-f0))

```{r, include=F}
rm(model.target_distance_learn, R2, apa_lmm.learn_distance, apa_post.learn_distance_group, apa_post.learn_distance_trial)
```

\newpage

#### **Initial rotation**

```{r, model_learn_rotation }
```

```{r, post_hoc_learn_rotation, include=F}
```

```{r, plot_learn_rotation, include=F}
```

```{r, echo=F, fig.height=4, fig.width=5, fig.cap="Trial curve for initial rotation in training." }
plot.rotation_learn 
rm(plot.rotation_learn)
```

```{r apa_learn_rotation, include=F}
R2 <- r2beta(model.rotation_learn$full_model, method='nsj', partial=F) %>% mutate_all(apa_num)

apa_lmm.learn_rotation <- apa_print(model.rotation_learn)

apa_post.learn_rotation_group_trial <- post.learn_rotation_group_trial %>% apa_print()

rm(post.learn_rotation_group_trial)
```

ref:l-ir-caption-f0) Fixed effects for initial rotation in training.

```{r table-learn-rotation-f0, echo=F}
apa_table(
  apa_lmm.learn_rotation$table,
  caption="(ref:l-ir-caption-f0)",
  placement="h")
```

(ref:l-ir-caption-r0) Random effects for initial rotation in training.

```{r table-learn-rotation-r0, echo=F}
apa_random_table(VarCorr(model.rotation_learn$full_model)) %>% 
  knitr::kable(
    caption="(ref:l-ir-caption-r0)")
```

The model had a fit of $R2 = `r R2$Rsq`, [CI: `r R2$upper.CL`, `r R2$lower.CL`$].

There was a significant *group x trial interaction* (`r apa_lmm.learn_rotation$statistic$group_trial_in_block`). Post-hoc polynomial contrasts showed that the (linear or quadratic) decrease of initial rotation across trials was significantly steeper in adults than 6-7-yo children (linear: `r apa_post.learn_rotation_group_trial$statistic$YoungKids_YoungAdults_Linear`;  quadratic: `r apa_post.learn_rotation_group_trial$statistic$YoungKids_YoungAdults_Quadratic`). 
(Table\ \@ref(tab:table-learn-rotation-f0))

```{r table-learn-rotation-1, echo=F}
apa_table(
  apa_post.learn_rotation_group_trial$table %>% remove_rownames(),
  placement="h")
```

```{r, include=F}
rm(model.rotation_learn, R2, apa_lmm.learn_rotation, apa_post.learn_rotation_group_trial)
```

\newpage

#### **Initial rotation velocity**

```{r, model_learn_rotation_velocity }
```

```{r, post_hoc_learn_rotation_velocity, include=F}
```

```{r, plot_learn_rotation_velocity, include=F}
```

```{r, echo=F, fig.height=4, fig.width=5, fig.cap="Trial curve for initial rotation velocity in training." }
plot.rotation_velocity_learn
rm(plot.rotation_velocity_learn)
```

```{r apa_learn_rotation_velocity, include=F}
R2 <- r2beta(model.rotation_velocity_learn$full_model, method='nsj', partial=F) %>% mutate_all(apa_num)

apa_lmm.learn_rotation_velocity <- apa_print(model.rotation_velocity_learn)
```

(ref:l-irv-caption-f0)  Fixed effects for factor initial rotation velocity.

```{r table-learn-rotation-velocity-f0, echo=F}
apa_table(
  apa_lmm.learn_rotation_velocity$table,
  caption="(ref:l-irv-caption-f0)",
  placement="h")
```

(ref:l-irv-caption-r0) Random effects for factor initial rotation velocity

```{r table-learn-rotation-velocity-r0, echo=F}
apa_random_table(VarCorr(model.rotation_velocity_learn$full_model)) %>% 
  knitr::kable(
    caption="(ref:l-irv-caption-r0)")
```

The model had a fit of $R2 = `r R2$Rsq`, [CI: `r R2$upper.CL`, `r R2$lower.CL`$].

There were no sigificant main effects or interactions for rotation velocity in training (Table\ \@ref(tab:table-learn-rotation-velocity-f0)). 


```{r, include=F}
rm(model.rotation_velocity_learn, R2, apa_lmm.learn_rotation_velocity)
```

\newpage

### Correlations 

TBD 

\newpage

### PLSC Analysis 

TBD, siehe Powerpoint Iryna 

\newpage

### Motor Control Task 

![Motor control practise task](./pics/Motor_Control.jpg){width=600px}

```{r, echo=F, fig.height=3, fig.width=6, fig.cap="Navigation behavior in practise trials." }

mc_plot <- function(data, xvar, yvar, my_colors, my_labels, y_label){
  p <- ggplot(data, aes(x=get(xvar), y=get(yvar), color=get(xvar), shape=get(xvar))) + 
    stat_summary(fun.data=mean_cl_normal, na.rm=TRUE, geom="errorbar", width=0.2, size=1.5) +
    stat_summary(fun=mean, na.rm=TRUE, geom="point", size=3) +
    scale_color_manual(values=my_colors, labels=my_labels, name=NULL) +
    scale_shape(guide="none") +
    coord_cartesian(ylim=c(0,NA)) +
    theme_bw(base_size=15) +
    theme(legend.position="top", legend.justification=c(0,0),
          legend.title=NULL, 
          panel.grid.major.x=element_blank(),
          axis.ticks.x=element_blank(),
          axis.text.x=element_blank()) +
    labs(x=NULL, y=y_label, 
         caption="mean and 95% CI")
  
  return(p)
}

mc_time <- mc_plot(practise, "group", "time", group_colors, group_labels, l_time)
mc_excess_path <- mc_plot(practise, "group", "excess_path_length", group_colors, group_labels, l_excess_path_length)
mc_rotation <- mc_plot(practise, "group", "rotation", group_colors, group_labels, l_rotation)

mc_time + mc_excess_path + mc_rotation + 
  plot_annotation("Navigation behavior in motor control task") + 
  plot_layout(guides="collect") & theme(legend.position="top", legend.justification=c(0,0))

rm(mc_time, mc_excess_path, mc_rotation, mc_plot, practise)
```

### Excluded trials 

```{r, echo=F, fig.height=3, fig.width=3, fig.cap="Overview of excluded trials." }

excluded_trials <- sm_orig %>% 
  group_by(id, group) %>% 
  tally(exclude_trial_matlab)

ggplot(excluded_trials, aes(x=n, fill=group, color=group)) + 
  geom_histogram(binwidth=1) + 
  scale_fill_manual(labels=group_labels, values=group_colors) + 
  scale_color_manual(labels=group_labels, values=group_colors_o) +
  theme_bw(base_size=15) + 
  theme(legend.position=c(0.8,0.8),
        legend.key.size=unit(0.5, 'cm')) + 
  labs(subtitle="Number of excluded trials",
       x="n trials",
       y="n participants")

rm(excluded_trials)
```
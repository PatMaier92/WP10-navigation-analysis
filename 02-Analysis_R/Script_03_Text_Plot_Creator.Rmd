---
title: "Text and Plot creator for WP10 Starmaze project"
author: "Patrizia Maier"
date: "`r format(Sys.time(), '%d %B, %Y')`"
output: 
  bookdown::word_document2:
    fig_caption: yes
    global_numbering: TRUE
    number_sections: TRUE
---

```{r setup, include=FALSE, cache=FALSE}
knitr::read_chunk('Script_02_Analyzer.R')
knitr::opts_chunk$set(warning=FALSE, message=FALSE) 
options(knitr.kable.NA='')
```

```{r, load_analysis_packages, include=FALSE, cache=FALSE}
```

```{r, include=FALSE}
file_name <- "../WP10_data/WP10_results/wp10_navigation_data.RData"
load(file_name)
sm_orig <- sm_data 
sm_data <- sm_data %>% filter(exclude_trial_matlab==0)
rm(file_name)

demographics <- sm_orig %>% 
  filter(session==1, trial==1) %>% 
  select(id, sex, group)

n_group <- demographics %>% group_by(group) %>% count()
n_group_sex <- demographics %>% group_by(group) %>% count(sex)

n_YK <- n_group %>% filter(group=="YoungKids") %>% pull
n_YK_f <- n_group_sex %>% filter(group=="YoungKids", sex=="Female") %>% pull
n_YK_m <- n_group_sex %>% filter(group=="YoungKids", sex=="Male") %>% pull

n_OK <- n_group %>% filter(group=="OldKids") %>% pull
n_OK_f <- n_group_sex %>% filter(group=="OldKids", sex=="Female") %>% pull
n_OK_m <- n_group_sex %>% filter(group=="OldKids", sex=="Male") %>% pull

n_AD <- n_group %>% filter(group=="YoungAdults") %>% pull
n_AD_f <- n_group_sex %>% filter(group=="YoungAdults", sex=="Female") %>% pull
n_AD_m <- n_group_sex %>% filter(group=="YoungAdults", sex=="Male") %>% pull

rm(demographics, n_group, n_group_sex)
```

```{r, include=FALSE}
file_name <- "../WP10_data/WP10_results/wp10_post_nav_data.RData"
load(file_name)
rm(file_name)

n_group_post <- pt_data %>% 
  filter(trial==1) %>% 
  select(id, sex, group) %>% 
  group_by(group) %>% count()

n_YK_p <- n_group_post %>% filter(group=="YoungKids") %>% pull
n_OK_p <- n_group_post %>% filter(group=="OldKids") %>% pull
n_AD_p <- n_group_post %>% filter(group=="YoungAdults") %>% pull

rm(n_group_post)
```

```{r, include=FALSE}
file_name <- "../WP10_data/WP10_results/wp10_plsc_age_by_NlS1PT_results_m3_g1.mat"
plsc_data_learn <- read.mat(file_name)
rm(file_name)
```

```{r, data_prep, include=FALSE}
```

```{r, plot_settings, include=FALSE}
```

```{r, analysis_settings, include=FALSE}
```

```{r, papaja_output_helper, include=FALSE}
```

# Methods 

## Sample
Cross-sectional comparison between

* 6-8 year-old children: n = `r n_YK` (female `r n_YK_f`/ male `r n_YK_m`); non-navigational data for n = `r n_YK_p`
* 9-11 year-old children: n = `r n_OK` (female `r n_OK_f`/ male `r n_OK_m`); non-navigational data for n = `r n_OK_p`
* 18-35 year-old adults:  n = `r n_AD` (female `r n_AD_f`/ male `r n_AD_m`); non-navigational data for n = `r n_AD_p`

```{r, include=FALSE}
rm(n_YK, n_YK_f, n_YK_m, n_YK_p, n_OK, n_OK_f, n_OK_m, n_OK_p, n_AD, n_AD_f, n_AD_m, n_AD_p)
```


## Variables of interest

In training trials, the goal is visible, i.e. the trial is always completed successfully. In probe trials, the goal is not visible. Participants go to the place where they remember the goal being located and press a button. 

*Memory accuracy*

* **Memory score** 
$$\text{Memory error (Euclidean distance)} = \sqrt{(x_{correct}-x_{remembered})^2 + (y_{correct}-y_{remembered})^2}$$
$$\text{Memory score} = \text{percentile rank of memory error on random error distribution}$$

*Navigation behavior*

* **Latency**
* **Excess path length** 
$$\text{(Ideal) path length} = \sum_{i=1}^{n} \sqrt{(x_{i}-x_{i+1})^2 + (y_{i}-y_{i+1})^2}$$
$$\text{Excess path length} = (path-path_{ideal})$$
* **Excess distance to goal**
$$\text{(Ideal) distance to goal} = \frac {\sum_{i=1}^{n}\sqrt{(x_{i}-x_{correct})^2 + (y_{i}-y_{correct})^2}} {n}$$
$$\text{Excess distance to goal} = (distance-distance_{ideal})$$
* **Initial rotation**
$$\text{Initial rotation} = \sum_{i=1}^{n_{initial}} | (z_{i}-z_{i+1})| $$

![Visualization of variables of interest](./pics/Var_all.jpg){width=300px,height=500x}
\newpage

# Results 

## Navigation behavior in learning session training trials

### **Latency (training trials)**

```{r, model_train_latency}
```

```{r, post_hoc_train_latency, include=F}
```

```{r, plot_train_latency, include=F}
```

```{r apa_train_latency, include=F}
R2 <- r2beta(model.latency_train$full_model, method='nsj', partial=F) %>% mutate_all(apa_num)

apa_lmm.train_latency <- apa_print(model.latency_train)

apa_post.train_latency_group <- post.train_latency_group %>% apa_print() %>% apa_bonferroni_fix()

apa_post.train_latency_trial <- post.train_latency_trial %>% apa_print() %>% apa_bonferroni_fix()

rm(post.train_latency_group, post.train_latency_trial)
```

The model had a fit of $R2 = `r R2$Rsq`, [CI: `r R2$upper.CL`, `r R2$lower.CL`$].

Latency decreased significantly across training trials in all age groups. In addition, there was a main effect of age group, showing that 6-8YO children required significantly more time to complete the training trials than both 9-11YO children (`r apa_post.train_latency_group$statistic$YoungKids_OldKids`) and adults (`r  apa_post.train_latency_group$statistic$YoungKids_YoungAdults`). 

```{r, include=F}
rm(model.latency_train, R2, apa_lmm.train_latency, apa_post.train_latency_group, apa_post.train_latency_trial)
```

### **Excess path length (training trials)**

```{r, model_train_path }
```

```{r, post_hoc_train_path, include=F}
```

```{r, plot_train_path, include=F}
```

```{r apa_train_path, include=F}
R2 <- r2beta(model.path_train$full_model, method='nsj', partial=F) %>% mutate_all(apa_num)

apa_lmm.train_path <- apa_print(model.path_train)

apa_post.train_path_group <- post.train_path_group %>% apa_print() %>% apa_bonferroni_fix()

apa_post.train_path_trial <- post.train_path_trial %>% apa_print() %>% apa_bonferroni_fix()

rm(post.train_path_group, post.train_path_trial)
```

The model had a fit of $R2 = `r R2$Rsq`, [CI: `r R2$upper.CL`, `r R2$lower.CL`$].

Similarly, participants in all age groups had a significant decrease in excess path length across trials and older participants were able to navigate more directly (i.e., shorter excess path length) than younger ones (6-8YO vs. 9-11YO: `r apa_post.train_path_group$statistic$YoungKids_OldKids`; 6-8YO vs. AD: `r apa_post.train_path_group$statistic$YoungKids_YoungAdults`; 9-11YO vs. AD: `r apa_post.train_path_group$statistic$OldKids_YoungAdults`).

```{r, include=F}
rm(model.path_train, R2, apa_lmm.train_path, apa_post.train_path_group, apa_post.train_path_trial)
```

### **Excess distance to goal (training trials)**

```{r, model_train_distance }
```

```{r, post_hoc_train_distance, include=F}
```

```{r, plot_train_distance, include=F}
```

```{r apa_train__distance, include=F}
R2 <- r2beta(model.distance_train$full_model, method='nsj', partial=F) %>% mutate_all(apa_num)

apa_lmm.train_distance <- apa_print(model.distance_train)

apa_post.train_distance_group <- post.train_distance_group %>% apa_print() %>% apa_bonferroni_fix()

apa_post.train_distance_trial <- post.train_distance_trial %>% apa_print() %>% apa_bonferroni_fix()

rm(post.train_distance_group, post.train_distance_trial)
```

(ref:l-ed-caption-f0) Fixed effects for excess distance to goal in training.

The model had a fit of $R2 = `r R2$Rsq`, [CI: `r R2$upper.CL`, `r R2$lower.CL`$].

Participants in all age groups had a significant decrease in excess distance to goal across trials, meaning that they searched closer to the goal location after the first trial. Again, there was a general age difference indicating that even though 6-8YO children improved across trials, they still searched further away from the goal location than both 9-11YO children (`r apa_post.train_distance_group$statistic$YoungKids_OldKids`) and adults (`r apa_post.train_distance_group$statistic$YoungKids_YoungAdults`). 

```{r, include=F}
rm(model.distance_train, R2, apa_lmm.train_distance, apa_post.train_distance_group, apa_post.train_distance_trial)
```

### **Initial rotation (training trials)**

```{r, model_train_initial_rotation }
```

```{r, post_hoc_train_initial_rotation, include=F}
```

```{r, plot_train_initial_rotation, include=F}
```

```{r apa_train_initial_rotation, include=F}
R2 <- r2beta(model.initial_rotation_train$full_model, method='nsj', partial=F) %>% mutate_all(apa_num)

apa_lmm.train_initial_rotation <- apa_print(model.initial_rotation_train)

apa_post.train_initial_rotation_group_trial <- post.train_initial_rotation_group_trial %>% apa_print() %>% apa_bonferroni_fix()

rm(post.train_initial_rotation_group_trial)
```

The model had a fit of $R2 = `r R2$Rsq`, [CI: `r R2$upper.CL`, `r R2$lower.CL`$].

Initial rotation significantly decreased across training trials only in adults (linear change across trials: `r apa_post.train_initial_rotation_group_trial$statistic$YoungAdults_Linear`) but stayed at a constant level in both groups of children. This indicates that adults, but not children, adjusted their level of deliberation and visual exploration at the first decision point according to task demands. 

```{r, include=F}
rm(model.initial_rotation_train, R2, apa_lmm.train_initial_rotation, apa_post.train_initial_rotation_group_trial)
```

```{r, include=F}
plot.latency_train <- plot.latency_train + theme(legend.position="none")
ggsave("../WP10_data/Plots/latency_train.jpg", plot.latency_train, width=3.7, height=3.0, dpi=600)

plot.path_train <- plot.path_train + theme(legend.position="none")
ggsave("../WP10_data/Plots/path_train.jpg", plot.path_train, width=3.7, height=3.0, dpi=600)

plot.distance_train <- plot.distance_train + theme(legend.position="none")
ggsave("../WP10_data/Plots/distance_train.jpg", plot.distance_train, width=3.7, height=3.0, dpi=600)

plot.initial_rotation_train <- plot.initial_rotation_train + theme(legend.position="none")
ggsave("../WP10_data/Plots/initial_rotation_train.jpg", plot.initial_rotation_train, width=3.7, height=3.0, dpi=600)

rm(plot.latency_train, plot.path_train, plot.distance_train, plot.initial_rotation_train)
```

\newpage

## Memory in learning session

### **Memory score (all probe trials)**

```{r, model_probe_ms }
```

```{r, fixef_probe_ms, include=F }
```

```{r, ranef_probe_ms, include=F }
```

```{r, post_hoc_probe_ms, include=F }
```

```{r, plot_probe_ms, include=F }
```

```{r apa_probe_ms, include=F}

# model fit 
R2 <- r2beta(model.ms$full_model, method='nsj', partial=F) %>% mutate_all(apa_num)

# fixed effects 
apa_lmm.ms <- apa_print(model.ms)

# group x condition
apa_post.ms_omega_group_condition <- omega.ms %>% 
  filter(Parameter=="group:condition") %>% select(Omega2_partial) %>% apa_num()

apa_post.ms_group_condition <- post.ms_group_condition %>% apa_print() %>% apa_bonferroni_fix()

# group 
apa_post.ms_omega_group <- omega.ms %>% 
  filter(Parameter=="group") %>% select(Omega2_partial) %>% apa_num()

apa_post.ms_group <- post.ms_group %>%  apa_print() %>% apa_bonferroni_fix()
apa_post.ms_group_chance <- post.ms_group_chance %>%  apa_print() %>% apa_bonferroni_fix()

# condition 
apa_post.ms_omega_condition <- omega.ms %>% 
  filter(Parameter=="condition") %>% select(Omega2_partial) %>% apa_num()

apa_post.ms_condition <- post.ms_condition %>%  apa_print()

# random effects LRT 
apa_rs.condition <- LRT.ms %>% mutate_at(vars(Chisq, Df), apa_df) %>% mutate_at(vars(p), apa_p, add_equals=T)


rm(post.ms_group, post.ms_group_chance, post.ms_condition, LRT.ms, omega.ms)
```

The model had a fit of $R2 = `r R2$Rsq`, [CI: `r R2$upper.CL`, `r R2$lower.CL`$].

There was a gradual improvement of memory with increasing age (6-8YO vs. 9-11YO: `r apa_post.ms_group$statistic$YoungKids_OldKids`; 6-8YO vs. AD: `r apa_post.ms_group$statistic$YoungKids_YoungAdults`; 9-11YO vs. AD: `r apa_post.ms_group$statistic$OldKids_YoungAdults`) and participants from all age groups reached above chance-level performance (test against 0.5 for 6-8YO: `r apa_post.ms_group_chance$estimate$YoungKids`; 9-11YO: `r apa_post.ms_group_chance$estimate$OldKids`; AD: `r apa_post.ms_group_chance$estimate$YoungAdults`). Participants had slightly better egocentric than allocentric memory. There was also a trend for an interaction between condition and age group, indicating that this advantage for egocentric memory was present in 9-11YO children (`r apa_post.ms_group_condition$statistic$OldKids_Egoret_alloret`) but not in 6-8YO children (`r apa_post.ms_group_condition$statistic$YoungKids_Egoret_alloret`) or adults (`r apa_post.ms_group_condition$statistic$YoungAdults_Egoret_alloret`).

The LMM with memory score had a significantly better fit when including the random slope for condition ($\chi^2$(`r apa_rs.condition$Df`) = `r apa_rs.condition$Chisq`, p `r apa_rs.condition$p`), meaning that there was substantial interindividual variation in how participants responded to the two conditions.

```{r, include=F}
plot.ms <- plot.ms + theme(legend.position="none")
ggsave("../WP10_data/Plots/memory_probe_1.jpg", plot.ms, width=3.5, height=3, dpi=600)

rm(plot.ms)
```

```{r, include=F}
rm(model.ms, R2, apa_lmm.ms, apa_post.ms_group, apa_post.ms_group_chance, apa_post.ms_condition, apa_post.ms_group_condition, apa_post.ms_omega_group, apa_post.ms_omega_condition, apa_post.ms_omega_group_condition, apa_rs.condition)
```

\newpage

## Memory consolidation across sessions  

### **Memory score (all probe trials)**

```{r, model_probe_ms_all }
```

```{r, fixef_probe_ms_all, include=F }
```

```{r, ranef_probe_ms_all, include=F }
```

```{r, post_hoc_probe_ms_all, include=F }
```

```{r, plot_probe_ms_all, include=F }
```

```{r apa_probe_ms_all, include=F}

# model fit 
R2 <- r2beta(model.ms_all$full_model, method='nsj', partial=F) %>% mutate_all(apa_num)

# fixed effects 
apa_lmm.ms_all <- apa_print(model.ms_all)

# group 
apa_post.ms_all_omega_group <- omega.ms_all %>% 
  filter(Parameter=="group") %>% select(Omega2_partial) %>% apa_num()

apa_post.ms_all_group <- post.ms_all_group %>%  apa_print() %>% apa_bonferroni_fix()
apa_post.ms_all_group_chance <- post.ms_all_group_chance %>%  apa_print() %>% apa_bonferroni_fix()

# condition 
apa_post.ms_all_omega_condition <- omega.ms_all %>% 
  filter(Parameter=="condition") %>% select(Omega2_partial) %>% apa_num()

apa_post.ms_all_condition <- post.ms_all_condition %>%  apa_print()

# session 
apa_post.ms_all_omega_session <- omega.ms_all %>% 
  filter(Parameter=="session") %>% select(Omega2_partial) %>% apa_num()

apa_post.ms_all_session <- post.ms_all_session %>%  apa_print()

# random effects LRT 
apa_rs.condition <- LRT.ms_all_condition %>% mutate_at(vars(Chisq, Df), apa_df) %>% mutate_at(vars(p), apa_p, add_equals=T)
apa_rs.session <- LRT.ms_all_session %>% mutate_at(vars(Chisq, Df), apa_df) %>% mutate_at(vars(p), apa_p, add_equals=T)


rm(post.ms_all_group, post.ms_all_group_chance, post.ms_all_condition, post.ms_all_session, LRT.ms_all_condition, LRT.ms_all_session, omega.ms_all)
```

To test if spatial memory consolidation improves with increasing age, we created a LMM with the memory score data from both sessions and conditions. In parallel to our previous analysis, the memory score was generally affected by age, with a gradual increase in memory performance with increasing age (6-8YO vs. 9-11YO: `r apa_post.ms_all_group$statistic$YoungKids_OldKids`; 6-8YO vs. AD: `r apa_post.ms_all_group$statistic$YoungKids_YoungAdults`; 9-11YO vs. AD: `r apa_post.ms_all_group$statistic$OldKids_YoungAdults`) and condition, with better performance in the egocentric than the allocentric condition. Memory deteriorated significantly over the two-week time period between sessions. Notably, none of the interactions between age group and session were significant, meaning that the amount of memory deterioration was not significantly higher in children compared to adults. One reason for the absence of age-related differences the consolidation of egocentric and allocentric memories acquired during navigation may be the pronounced group differences after learning. We ran a control analysis using only well-learned pairs (details in the supplement), where we found some evidence for age-related differences in spatial memory consolidation.

The LMM had a significantly better fit when including the random slope for session ($\chi^2$(`r apa_rs.session$Df`) = `r apa_rs.session$Chisq`, p `r apa_rs.session$p`), meaning that there was substantial interindividual variation in forgetting rates across the two-week delay period - irrespective of their age. Likewise, the model fit improved when including the random slope for condition ($\chi^2$(`r apa_rs.condition$Df`) = `r apa_rs.condition$Chisq`, p `r apa_rs.condition$p`). 

```{r, include=F }
plot.ms_all <- plot.ms_all + theme(legend.position="none")
ggsave("../WP10_data/Plots/memory_probe_con.jpg", plot.ms_all, width=4.3, height=4, dpi=600)

rm(plot.ms_all)
```

```{r, include=F}
rm(model.ms_all, apa_lmm.ms_all, apa_post.ms_all_group, apa_post.ms_all_group_chance, apa_post.ms_all_condition, apa_post.ms_all_session, apa_post.ms_all_omega_group, apa_post.ms_all_omega_condition, apa_post.ms_all_omega_session, apa_rs.condition, apa_rs.session)
```

### **Post-navigational memory tasks**

```{r, model_post_layout, include=F }
```

```{r, plot_post_layout, include=F }
```

```{r, model_post_landmark, include=F }
```

```{r, plot_post_landmark, include=F }
```

```{r, model_post_position, include=F }
```

```{r, plot_post_position, include=F }
```

### **Layout**

```{r apa_layout, include=F}
apa_fisher.layout <- model.layout %>% pluck("p.value") %>% apa_p(add_equals=T)

apa_post.layout_young_vs_old <- post.layout$p.adj[1] %>% apa_p(add_equals=T)
apa_post.layout_young_vs_adult <- post.layout$p.adj[2] %>% apa_p(add_equals=T)
apa_post.layout_old_vs_adult <- post.layout$p.adj[3] %>% apa_p(add_equals=T)
rm(post.layout)
```

We found significant age differences in the ability to correctly identify the geometrical maze layout (Fisher's exact test $p$ `r apa_fisher.layout`) with a gradual performance increase with increasing age (6-8YO vs. 9-11YO: $p$ `r apa_post.layout_young_vs_old`; 6-8YO vs. AD: $p$ `r apa_post.layout_young_vs_adult`; 9-11YO vs. AD: $p$ `r apa_post.layout_old_vs_adult`).

```{r, include=F}
rm(model.layout, apa_fisher.layout, apa_post.layout_young_vs_old, apa_post.layout_young_vs_adult, apa_post.layout_old_vs_adult)
```

### **Landmarks**

```{r apa_landmark, include=F}
apa_aov.landmark <- apa_print(model.landmark)
```

There were no significant age differences in the ability to correctly identify the landmark objects (`r apa_aov.landmark$statistic$group`). 

```{r, include=F}
rm(model.landmark, apa_aov.landmark)
```

### **Positioning**

```{r apa_position, include=F}
apa_aov.position <- apa_print(model.position)

apa_post.position <- post.position$contrasts %>% apa_print() %>% apa_bonferroni_fix()
rm(post.position)
```

Lastly, we did find significant age differences in the ability to correctly position the landmark and goal objects in a map (`r apa_aov.position$statistic$group`). Here, adults performed significantly better than both groups of children (6-8YO vs. AD: `r apa_post.position$statistic$YoungKids_YoungAdults`; 9-11YO vs. AD: `r apa_post.position$statistic$OldKids_YoungAdults`) but the children groups did not differ (6-8YO vs. 9-11YO: `r apa_post.position$statistic$YoungKids_OldKids`). 

```{r, include=F}
rm(model.position, apa_aov.position, apa_post.position)
```

```{r, include=F}
plot.layout <- plot.layout + theme(legend.position="none")
ggsave("../WP10_data/Plots/post_layout.jpg", plot.layout, width=2.2, height=3.3, dpi=600)

plot.landmark <- plot.landmark + theme(legend.position="none")
ggsave("../WP10_data/Plots/post_landmark.jpg", plot.landmark, width=2.2, height=3.3, dpi=600)

plot.position <- plot.position + theme(legend.position="none")
ggsave("../WP10_data/Plots/post_position.jpg", plot.position, width=2.2, height=3.3, dpi=600)

rm(plot.layout, plot.landmark, plot.position)
```

\newpage 

## Partial Least Square Correlation (PLSC) Analysis

```{r, plot_plsc_lv_learn, include=F}
```

```{r, plot_plsc_age_x_lp_nav_learn, include=F}
```

```{r, plot_plsc_age_x_lp_post_learn, include=F}
```

```{r, plot_plsc_memory_x_lp_nav_learn, include=F}
```

```{r, plot_plsc_memory_x_lp_post_learn, include=F}
```

```{r apa_plsc_learn, include=F}
# LV 
apa_lv.p <- lv.p
apa_lv.cor <- lv.cor
apa_lv.ulcor <- lv.ulcor
apa_lv.llcor <- lv.llcor
# ($r$ = `r apa_lv.cor`, 95% CI[`r apa_lv.llcor`, `r apa_lv.ulcor`])

# BSR
apa_bsr <- bsr %>% 
  select(name, value) %>% 
  pivot_wider(names_from=name, values_from=value) %>% apa_num()

rm(lv.p, lv.cor, lv.ulcor, lv.llcor)
```

```{r apa_plsc_nav_learn, include=F}
p_bonferroni4 <- "$p_\\mathrm{Bonferroni(4)}$"

# LP correlations
apa_model.age_lp_n <- model.age_lp_nav_learn %>% apa_print() %>% apa_correlation_fix()

apa_model.lp_n_ego_1 <- model.lp_n_ego_1 %>% apa_print() %>% apa_correlation_fix(addp=F)
apa_model.lp_n_ego_2 <- model.lp_n_ego_2 %>% apa_print() %>% apa_correlation_fix(addp=F)
apa_model.p_lp_n_ego <- model.comp_lp_n_ego$p$`p_bonf(4)` %>% as.numeric() %>% apa_p(add_equals=T)

apa_model.lp_n_allo_1 <- model.lp_n_allo_1 %>% apa_print() %>% apa_correlation_fix(addp=F)
apa_model.lp_n_allo_2 <- model.lp_n_allo_2 %>% apa_print() %>% apa_correlation_fix(addp=F)
apa_model.p_lp_n_allo <- model.comp_lp_n_allo$p$`p_bonf(4)` %>% as.numeric() %>% apa_p(add_equals=T)

apa_model.p_lp_n_ego_allo_1 <- model.comp_lp_n_ego_allo_1$p$`p_bonf(4)` %>% as.numeric() %>% apa_p(add_equals=T)
apa_model.p_lp_n_ego_allo_2 <- model.comp_lp_n_ego_allo_2$p$`p_bonf(4)` %>% as.numeric() %>% apa_p(add_equals=T)

rm(lv.p, lv.cor, lv.ulcor, lv.llcor, model.age_lp_nav_learn, model.lp_n_ego_1, model.lp_n_ego_2, model.lp_n_allo_1, model.lp_n_allo_2, model.comp_lp_n_ego, model.comp_lp_n_allo, model.comp_lp_n_ego_allo_1, model.comp_lp_n_ego_allo_2)
```

```{r apa_plsc_post_learn, include=F}
# LP correlations
apa_model.age_lp_p <- model.age_lp_post_learn %>% apa_print() %>% apa_correlation_fix()

apa_model.lp_p_ego_1 <- model.lp_p_ego_1 %>% apa_print() %>% apa_correlation_fix(addp=F)
apa_model.lp_p_ego_2 <- model.lp_p_ego_2 %>% apa_print() %>% apa_correlation_fix(addp=F)
apa_model.p_lp_p_ego <- model.comp_lp_p_ego$p$`p_bonf(4)` %>% as.numeric() %>% apa_p(add_equals=T)

apa_model.lp_p_allo_1 <- model.lp_p_allo_1 %>% apa_print() %>% apa_correlation_fix(addp=F)
apa_model.lp_p_allo_2 <- model.lp_p_allo_2 %>% apa_print() %>% apa_correlation_fix(addp=F)
apa_model.p_lp_p_allo <- model.comp_lp_p_allo$p$`p_bonf(4)` %>% as.numeric() %>% apa_p(add_equals=T)

apa_model.p_lp_p_ego_allo_1 <- model.comp_lp_p_ego_allo_1$p$`p_bonf(4)` %>% as.numeric() %>% apa_p(add_equals=T)
apa_model.p_lp_p_ego_allo_2 <- model.comp_lp_p_ego_allo_2$p$`p_bonf(4)` %>% as.numeric() %>% apa_p(add_equals=T)

rm(lv.p, lv.cor, lv.ulcor, lv.llcor, model.age_lp_post_learn, model.lp_p_ego_1, model.lp_p_ego_2, model.lp_p_allo_1, model.lp_p_allo_2, model.comp_lp_p_ego, model.comp_lp_p_allo, model.comp_lp_p_ego_allo_1, model.comp_lp_p_ego_allo_2)
```

Finally, we wanted to test if the age-related variations in 1) navigation behavior during the initial training phase and 2) spatial knowledge can predict spatial memory. We applied PLSC and identified a single reliable LV ($p$ `r apa_lv.p`; Figure 4) that optimally represents associations between age and a profile of navigation indicators from training trials in the learning session (`r apa_model.age_lp_n$r_and_p`) and spatial knowledge indicators from the post-navigational tests (`r apa_model.age_lp_p$r_and_p`). We identified several stable components within the multivariate profile, paralleling our previous results. Higher age was associated with a specific navigation pattern during the initial training phase i.e., shorter latency (BSR = `r apa_bsr$latency`), more direct navigation (excess path length; BSR = `r apa_bsr$"excess path length"`), and search near the goal (excess distance to goal; BSR = `r apa_bsr$"excess distance to goal"`) but not visual exploration at the first decision point (initial rotation; BSR = `r apa_bsr$"initial rotation"`). Higher age was also associated with specific pattern of spatial knowledge at the end of the experiment i.e., a higher layout score (BSR = `r apa_bsr$"layout score"`) and positioning score (BSR = `r apa_bsr$"positioning score"`) but not landmarks score (BSR = `r apa_bsr$"landmark score"`). 

As a second step, we computed two latent profile scores (LPS) for each participant, one for navigation and one for spatial knowledge. A more positive LPS indicates that an individual expressed the age-related profile more strongly, which means that children with a high LPS score expressed more adult-like behavior. We then correlated the LPS with immediate and long-delay egocentric and allocentric memory (Table 5; Figure 4). The navigation LPS correlated significantly with immediate egocentric (`r apa_model.lp_n_ego_1$r_and_p`) and long-delay egocentric memory (`r apa_model.lp_n_ego_2$r_and_p`), and the former was significantly higher (`r p_bonferroni4` `r apa_model.p_lp_n_ego`). The navigation LPS also correlated significantly with immediate allocentric (`r apa_model.lp_n_allo_1$r_and_p`) and long-delay allocentric memory (`r apa_model.lp_n_allo_2$r_and_p`). The correlation with immediate egocentric memory was significantly higher than with immediate allocentric memory (`r p_bonferroni4` `r apa_model.p_lp_n_ego_allo_1`). In conclusion, we found that navigation behavior during training predicted later memory performance. Participants with a more more efficient, adult-like navigation during training had better immediate and long-delay spatial memory. There was a particularly strong association with immediate egocentric memory. The spatial knowledge LPS also correlated significantly with immediate egocentric (`r apa_model.lp_p_ego_1$r_and_p`), long-delay egocentric (`r apa_model.lp_p_ego_2$r_and_p`), immediate allocentric (`r apa_model.lp_p_allo_1$r_and_p`) and long-delay allocentric memory (`r apa_model.lp_p_allo_2$r_and_p`). Thus, participants with a better understanding of the geometrical maze layout and object-to-object positions  had better immediate and long-delay spatial memory. 

```{r include=F}
rm(apa_lv.p, apa_lv.cor, apa_lv.ulcor, apa_lv.llcor, apa_bsr, apa_model.age_lp_n, apa_model.age_lp_p, apa_model.lp_n_ego_1, apa_model.lp_n_ego_2, apa_model.lp_n_allo_1, apa_model.lp_n_allo_2, apa_model.p_lp_n_ego, apa_model.p_lp_n_allo, apa_model.lp_p_ego_1, apa_model.lp_p_ego_2, apa_model.lp_p_allo_1, apa_model.lp_p_allo_2, apa_model.p_lp_p_ego, apa_model.p_lp_p_allo, apa_model.p_lp_n_ego_allo_1, apa_model.p_lp_n_ego_allo_2, apa_model.p_lp_p_ego_allo_1, apa_model.p_lp_p_ego_allo_2)
```

```{r, include=F}
ggsave("../WP10_data/Plots/bsr_learn.jpg", plot.bsr_learn, width=4.7, height=3.2, dpi=600)

plot.age_x_lp_nav_learn <-  plot.age_x_lp_nav_learn + theme(legend.position="none")
ggsave("../WP10_data/Plots/age_x_lp_nav_learn.jpg", plot.age_x_lp_nav_learn, width=3, height=3, dpi=600)

plot.age_x_lp_post_learn <- plot.age_x_lp_post_learn + theme(legend.position="none")
ggsave("../WP10_data/Plots/age_x_lp_post_learn.jpg", plot.age_x_lp_post_learn, width=3, height=3, dpi=600)

ggsave("../WP10_data/Plots/mem_x_lp_nav_learn.jpg", plot.mem_x_lp_nav_learn, width=5.5, height=3.8, dpi=600)

ggsave("../WP10_data/Plots/mem_x_lp_post_learn.jpg", plot.mem_x_lp_post_learn, width=5.5, height=3.8, dpi=600)

rm(plot.bsr_learn, plot.age_x_lp_nav_learn, plot.age_x_lp_post_learn, plot.mem_x_lp_post_learn)
```

\newpage

# Supplementary material 

## Motor control task 

```{r, echo=F, fig.height=3, fig.width=5, fig.cap="Navigation in practise trials." }

mc_plot <- function(data, xvar, yvar, my_colors, my_labels, y_label){
  p <- ggplot(data, aes(x=get(xvar), y=get(yvar), color=get(xvar), shape=get(xvar))) + 
    stat_summary(fun.data=mean_cl_normal, na.rm=TRUE, geom="errorbar", width=0.2, size=1.5) +
    stat_summary(fun=mean, na.rm=TRUE, geom="point", size=3) +
    scale_color_manual(values=my_colors, labels=my_labels, name=NULL) +
    scale_shape(guide="none") +
    coord_cartesian(ylim=c(0,NA)) +
    theme_classic(base_size=13) +
    theme(legend.position="top", legend.justification=c(0,0),
          legend.title=NULL, 
          panel.grid.major.x=element_blank(),
          axis.ticks.x=element_blank(),
          axis.text.x=element_blank()) +
    labs(x=NULL, y=y_label, 
         caption="mean and 95% CI")
  
  return(p)
}

mc_latency <- mc_plot(practise, "group", "time", group_colors_f, group_labels, l_latency)
mc_excess_path <- mc_plot(practise, "group", "excess_path_length", group_colors_f, group_labels, l_excess_path_length)

mc_latency + mc_excess_path + 
  plot_annotation("Navigation behavior in motor control task") + 
  plot_layout(guides="collect") & theme(legend.position="top", legend.justification=c(0,0))

rm(mc_latency, mc_excess_path, mc_plot)
```

```{r, model_motor_control, include=F }
```

```{r apa_motor_control, include=F}
apa_aov.motor_latency <- apa_print(model.motor_latency)
post_aov.motor_latency_group <- post.motor_latency %>% apa_print() %>% apa_bonferroni_fix()
rm(model.motor_latency, post.motor_latency)

apa_aov.motor_path <- apa_print(model.motor_path)
post_aov.motor_path_group <- post.motor_path %>% apa_print() %>% apa_bonferroni_fix()
rm(model.motor_path, post.motor_path)

rm(practise)
```

There were significant age group differences the motor control task, aimed to assess the ability to use a joystick in the initial practise phase. Specifically, 6-8YO children required more time to solve the task (`r apa_aov.motor_latency$statistic$group`; 6-8YO vs. 9-11YO: `r post_aov.motor_latency_group$statistic$YoungKids_OldKids`; 6-8YO vs. AD: `r post_aov.motor_latency_group$statistic$YoungKids_YoungAdults`) and had longer excess paths (`r apa_aov.motor_path$statistic$group`; 6-8YO vs. 9-11YO: `r post_aov.motor_path_group$statistic$YoungKids_OldKids`; 6-8YO vs. AD: `r post_aov.motor_path_group$statistic$YoungKids_YoungAdults`). We wanted to account for this potential confounder and computed a motor control score by averaging the z-scored latency and z-scored excess path length during practise. We then used this motor control score a model covariate in all our LMMs.  

## Number of excluded trials 

```{r, echo=F, fig.height=3, fig.width=3, fig.cap="Overview of excluded trials." }

data_excluded <- sm_orig %>% 
  group_by(id, group) %>% 
  count(exclude_trial_matlab) %>% 
  ungroup() %>% 
  complete(exclude_trial_matlab, nesting(id, group), fill=list(n=0))

n_excluded_p <- data_excluded %>% 
  filter(exclude_trial_matlab==1) %>% 
  ungroup %>%   
  summarise(min=min(n), max=max(n), mean=mean(n), sd=sd(n)) %>% 
  mutate_all(round, 2)

n_excluded_t <- sm_orig %>% 
  count(exclude_trial_matlab)

ggplot(data_excluded %>% filter(exclude_trial_matlab==1), aes(x=n, fill=group, color=group)) + 
  geom_histogram(binwidth=1) + 
  scale_fill_manual(labels=group_labels, values=group_colors_f) + 
  scale_color_manual(labels=group_labels, values=group_colors_c) +
  theme_classic(base_size=13) + 
  theme(legend.position=c(0.8,0.8),
        legend.key.size=unit(0.5, 'cm')) + 
  labs(subtitle="Number of excluded trials",
       x="n trials",
       y="n participants")

rm(data_excluded)
```

How many trials were marked for exclusion?

Percentage of excluded trials among all trials: `r round((n_excluded_t %>%  filter(exclude_trial_matlab==1) %>% pull) / (n_excluded_t %>% filter(exclude_trial_matlab==0) %>% pull) * 100, 2)` % 

N per participant 
min: `r n_excluded_p %>% select(min) %>% pull`
max: `r n_excluded_p %>% select(max) %>% pull`
mean: `r n_excluded_p %>% select(mean) %>% pull`
sd: `r n_excluded_p %>% select(sd) %>% pull`

\newpage

## Memory consolidation control analysis

### **Memory score (all probe trials with well-learned pairs)**

```{r, model_probe_ms_wl }
```

```{r, fixef_probe_ms_wl, include=F }
```

```{r, ranef_probe_ms_wl, include=F }
```

```{r, post_hoc_probe_ms_wl, include=F }
```

```{r, plot_probe_ms_wl, include=F }
```

```{r apa_probe_ms_wl, include=F}

# model fit 
R2 <- r2beta(model.ms_wl$full_model, method='nsj', partial=F) %>% mutate_all(apa_num)

# fixed effects 
apa_lmm.ms_wl <- apa_print(model.ms_wl)

# group x session 
apa_post.ms_wl_omega_group_session <- omega.ms_wl %>% 
  filter(Parameter=="group:session") %>% select(Omega2_partial) %>% apa_num()

apa_post.ms_wl_group_session <- post.ms_wl_group_session %>%  apa_print() %>% apa_bonferroni_fix()

# group 
apa_post.ms_wl_omega_group <- omega.ms_wl %>% 
  filter(Parameter=="group") %>% select(Omega2_partial) %>% apa_num()

# condition 
apa_post.ms_wl_omega_condition <- omega.ms_wl %>% 
  filter(Parameter=="condition") %>% select(Omega2_partial) %>% apa_num()

apa_post.ms_wl_condition <- post.ms_wl_condition %>%  apa_print()

# session 
apa_post.ms_wl_omega_session <- omega.ms_wl %>% 
  filter(Parameter=="session") %>% select(Omega2_partial) %>% apa_num()

# random effects LRT 
apa_rs.session <- LRT.ms_wl %>% mutate_at(vars(Chisq, Df), apa_df) %>% mutate_at(vars(p), apa_p, add_equals=T)

# reduced sample size 
n_wl <- data_p_w %>% group_by(id, group) %>% summarize(m = mean(memory_score, na.rm=T)) %>% ungroup() %>% count(group)
n_wl_YK <- n_wl %>% filter(group=="YoungKids") %>% pull
n_wl_OK <- n_wl %>% filter(group=="OldKids") %>% pull
n_wl_AD <- n_wl %>% filter(group=="YoungAdults") %>% pull

rm(post.ms_wl_group_session, post.ms_wl_condition, LRT.ms_wl, omega.ms_wl, n_wl)
```

We ran a control analysis to further explore if initial learning differences explain why we did not find any age-related differences in memory consolidation.
Here, we computed another LMM with the memory score but included only object-location pairs that were well-learned in the first session. Well-learned was defined as finding the correct goal (i.e., pressing the button in the correct alley or the adjacent intersection) in at least two out of three learning session probe trials in both egocentric and allocentric conditions. Trials with object-location pairs that did not meet this criterion were excluded. This reduced our sample to n = `r n_wl_YK` 6-8YO, n = `r n_wl_OK` 9-11YO, and n = `r n_wl_AD` adults. 

The results paralleled our previous analysis, namely we found main effects for age group, condition and session. In addition, we did find evidence for an interaction between age group and session for well-learned pairs. Post-hoc contrasts showed that while there were no age-related performance differences for well-learned pairs during learning, adults remembered them significantly better than both 6-8YO children (`r apa_post.ms_wl_group_session$statistic$X2__YoungKids_YoungAdults`) and 9-11YO children (`r apa_post.ms_wl_group_session$statistic$X2__OldKids_YoungAdults`) after the two-week delay period. This implies that adults may profit from superior consolidation compared to children when having a comparable level of initial learning. However, comparing the forgetting slopes directly between age groups did not yield significant differences (session 1 vs 2 in 6-8YO vs. 9-11YO: `r apa_post.ms_wl_group_session$statistic$YoungKids_OldKids_1_2_`; in 6-8YO vs. AD: `r apa_post.ms_wl_group_session$statistic$YoungKids_YoungAdults_1_2_`; in 9-11YO vs AD: `r apa_post.ms_wl_group_session$statistic$OldKids_YoungAdults_1_2_`) and the effect size for the interaction was relatively small ($\omega^2 =$ `r apa_post.ms_wl_omega_group_session`). 

The LMM had a significantly better fit when including the random slope for session ($\chi^2$(`r apa_rs.session$Df`) = `r apa_rs.session$Chisq`, p `r apa_rs.session$p`), meaning that there was interindividual variation in participant's forgetting rates across the two-week delay period.

```{r,include=F}
plot.ms_wl <- plot.ms_wl + theme(legend.position="none")
ggsave("../WP10_data/Plots/memory_probe_con_wl.jpg", plot.ms_wl, width=4.8, height=4, dpi=600)

rm(plot.ms_wl)
```

```{r, include=F}
rm(model.ms_wl, apa_lmm.ms_wl, apa_post.ms_wl_group_session,apa_post.ms_wl_condition, apa_post.ms_wl_omega_group_session, apa_post.ms_wl_omega_group, apa_post.ms_wl_omega_condition, apa_post.ms_wl_omega_session, apa_rs.session, n_wl_YK, n_wl_OK, n_wl_AD)
```
 
\newpage
 
## Navigation behavior in learning session probe trials

### **Latency (probe session 1)**

```{r, model_probe_latency}
```

```{r, fixef_probe_latency, include=F }
```

```{r, ranef_probe_latency, include=F }
```

```{r, post_hoc_probe_latency, include=F }
```

```{r, plot_probe_latency, include=F }
```

```{r apa_probe_latency, include=F}

# model fit
R2 <- r2beta(model.latency_probe$full_model, method='nsj', partial=F) %>% mutate_all(apa_num)

# fixed effects
apa_lmm.latency_probe  <- apa_print(model.latency_probe)

# group x condition 
apa_post.latency_probe_omega_group_condition <- omega.latency_probe %>% 
  filter(Parameter=="group:condition") %>% select(Omega2_partial) %>% apa_num()

apa_post.latency_probe_group_condition <- post.latency_probe_group_condition %>% apa_print() %>% apa_bonferroni_fix()

# group 
apa_post.latency_probe_omega_group <- omega.latency_probe %>% 
  filter(Parameter=="group") %>% select(Omega2_partial) %>% apa_num()

# condition
apa_post.latency_probe_omega_condition <- omega.latency_probe %>% 
  filter(Parameter=="condition") %>% select(Omega2_partial) %>% apa_num()

# random effects LRT 
apa_rs.condition <- LRT.latency_probe %>% mutate_at(vars(Chisq, Df), apa_df) %>% mutate_at(vars(p), apa_p, add_equals=T)


rm(post.latency_probe_group_condition, LRT.latency_probe, omega.latency_probe)
```

The model had a fit of $R2 = `r R2$Rsq`, [CI: `r R2$upper.CL`, `r R2$lower.CL`$].

Participants from all age groups had a higher latency in the allocentric than the egocentric condition. Additionally, 6-8YO children had a higher latency than adults in the egocentric (`r apa_post.latency_probe_group_condition$statistic$Egoret_YoungKids_YoungAdults`) and allocentric condition (`r apa_post.latency_probe_group_condition$statistic$Alloret_YoungKids_YoungAdults`). There was a trend for a significant difference between 9-11YO children and adults in allocentric only (`r apa_post.latency_probe_group_condition$statistic$Alloret_OldKids_YoungAdults`).

The LMM with latency did not have a significantly better fit when including the random slope for condition ($\chi^2$(`r apa_rs.condition$Df`) = `r apa_rs.condition$Chisq`, p `r apa_rs.condition$p`).

```{r, include=F}
rm(model.latency_probe, R2, apa_lmm.latency_probe, apa_post.latency_probe_group_condition, apa_post.latency_probe_omega_group_condition, apa_post.latency_probe_omega_group, apa_post.latency_probe_omega_condition, apa_rs.condition)
```

### **Excess path length (probe session 1)**

```{r, model_probe_path }
```

```{r, fixef_probe_path, include=F }
```

```{r, ranef_probe_path, include=F }
```

```{r, post_hoc_probe_path, include=F }
```

```{r, plot_probe_path, include=F }
```

```{r apa_probe_path, include=F}
# model fit
R2 <- r2beta(model.path_probe$full_model, method='nsj', partial=F) %>% mutate_all(apa_num)

# fixed effects 
apa_lmm.path_probe <- apa_print(model.path_probe)

# group x condition 
apa_post.path_probe_omega_group_condition <- omega.path_probe %>% 
  filter(Parameter=="group:condition") %>% select(Omega2_partial) %>% apa_num()

apa_post.path_probe_group_condition <- post.path_probe_group_condition %>% apa_print() %>% apa_bonferroni_fix()

# group
apa_post.path_probe_omega_group <- omega.path_probe %>% 
  filter(Parameter=="group") %>% select(Omega2_partial) %>% apa_num()

# condition
apa_post.path_probe_omega_condition <- omega.path_probe %>% 
  filter(Parameter=="condition") %>% select(Omega2_partial) %>% apa_num()

# random effects LRT 
apa_rs.condition <- LRT.path_probe %>% mutate_at(vars(Chisq, Df), apa_df) %>% mutate_at(vars(p), apa_p, add_equals=T)


rm(post.path_probe_group_condition, LRT.path_probe, omega.path_probe)
```

The model had a fit of $R2 = `r R2$Rsq`, [CI: `r R2$upper.CL`, `r R2$lower.CL`$].

Participants from all age groups had longer excess path lengths in the allocentric than the egocentric condition. In the egocentric condition, 6-8YO children had significantly longer excess paths than adults (`r apa_post.path_probe_group_condition$statistic$Egoret_YoungKids_YoungAdults`), in the allocentric condition there was a gradual decrease in excess path with increasing age (6-8YO vs. AD: `r apa_post.path_probe_group_condition$statistic$Alloret_YoungKids_YoungAdults`; 6-8YO vs. 9-11YO: `r apa_post.path_probe_group_condition$statistic$Alloret_YoungKids_OldKids`;9-11YO vs. AD: `r apa_post.path_probe_group_condition$statistic$Alloret_OldKids_YoungAdults`).

The LMM with excess path length did not have a significantly better fit when including the random slope for condition ($\chi^2$(`r apa_rs.condition$Df`) = `r apa_rs.condition$Chisq`, p `r apa_rs.condition$p`).

```{r, include=F}
rm(model.path_probe, apa_lmm.path_probe, apa_post.path_probe_group_condition, apa_post.path_probe_omega_group_condition, apa_post.path_probe_omega_group, apa_post.path_probe_omega_condition, apa_rs.condition)
```

### **Excess distance to goal (probe session 1)**

```{r, model_probe_distance }
```

```{r, fixef_probe_distance, include=F }
```

```{r, ranef_probe_distance, include=F }
```

```{r, post_hoc_probe_distance, include=F }
```

```{r, plot_probe_distance, include=F }
```

```{r apa_probe_distance, include=F}
# model fit 
R2 <- r2beta(model.distance_probe$full_model, method='nsj', partial=F) %>% mutate_all(apa_num)

# fixed effects 
apa_lmm.distance_probe <- apa_print(model.distance_probe)

# group 
apa_post.distance_probe_omega_group <- omega.distance_probe %>% 
  filter(Parameter=="group") %>% select(Omega2_partial) %>% apa_num()

apa_post.distance_probe_group <- post.distance_probe_group %>% apa_print() %>% apa_bonferroni_fix()

# condition
apa_post.distance_probe_omega_condition <- omega.distance_probe %>% 
  filter(Parameter=="condition") %>% select(Omega2_partial) %>% apa_num()

apa_post.distance_probe_condition <- post.distance_probe_condition %>% apa_print()

# random effects LRT
apa_rs.condition <- LRT.distance_probe %>% mutate_at(vars(Chisq, Df), apa_df) %>% mutate_at(vars(p), apa_p, add_equals=T)


rm(post.distance_probe_group, post.distance_probe_condition, LRT.distance_probe, omega.distance_probe)
```

The model had a fit of $R2 = `r R2$Rsq`, [CI: `r R2$upper.CL`, `r R2$lower.CL`$].

For excess distance to goal there was a gradual decrease with increasing age, meaning that that older participants searched in closer proximity to the actual goal locations than younger ones (6-8YO vs. 9-11YO: `r apa_post.distance_probe_group$statistic$YoungKids_OldKids`; 6-8YO vs. AD: `r apa_post.distance_probe_group$statistic$YoungKids_YoungAdults`; 9-11YO vs. AD: `r apa_post.distance_probe_group$statistic$OldKids_YoungAdults`). Additionally, participants from all age groups searched closer to the goal in the egocentric than the allocentric condition.

The LMM with excess distance to goal did have a significantly better fit when including the random slope for condition ($\chi^2$(`r apa_rs.condition$Df`) = `r apa_rs.condition$Chisq`, p `r apa_rs.condition$p`).

```{r, include=F}
rm(model.distance_probe, apa_lmm.distance_probe, apa_post.distance_probe_group, apa_post.distance_probe_condition, apa_post.distance_probe_omega_group, apa_post.distance_probe_omega_condition, apa_rs.condition)
```

### **Initial rotation (probe session 1)**

```{r, model_probe_initial_rotation}
```
 
```{r, fixef_probe_initial_rotation, include=F }
```

```{r, ranef_probe_initial_rotation, include=F }
```

```{r, post_hoc_probe_initial_rotation, include=F }
```

```{r, plot_probe_initial_rotation, include=F }
```

```{r apa_probe_initial_rotation, include=F }

# model fit
R2 <- r2beta(model.initial_rotation_probe$full_model, method='nsj', partial=F) %>% mutate_all(apa_num)

# fixed effects
apa_lmm.init_rot_probe <- apa_print(model.initial_rotation_probe)

# condition 
apa_post.initial_rotation_probe_omega_condition <- omega.initial_rotation_probe %>% 
  filter(Parameter=="condition") %>% select(Omega2_partial) %>% apa_num()

apa_post.init_rot_probe_condition <- post.init_rot_probe_condition %>% apa_print()

# random effects LRT 
apa_rs.condition <- LRT.initial_rotation_probe %>% mutate_at(vars(Chisq, Df), apa_df) %>% mutate_at(vars(p), apa_p, add_equals=T)


rm(post.init_rot_probe_condition, LRT.initial_rotation_probe, omega.initial_rotation_probe)
```

The model had a fit of $R2 = `r R2$Rsq`, [CI: `r R2$upper.CL`, `r R2$lower.CL`$].

The amount of initial rotation did not differ between age groups but was significantly higher in the allocentric than the egocentric condition.

The LMM with initial rotation did have a significantly better fit when including the random slope for condition ($\chi^2$(`r apa_rs.condition$Df`) = `r apa_rs.condition$Chisq`, p `r apa_rs.condition$p`).

```{r, include=F}
rm(model.initial_rotation_probe, apa_lmm.init_rot_probe, apa_post.init_rot_probe_condition, apa_post.initial_rotation_probe_omega_condition, apa_rs.condition)
```

```{r, include=F}
plot.latency_probe <- plot.latency_probe + theme(legend.position="none")
ggsave("../WP10_data/Plots/latency_probe.jpg", plot.latency_probe, width=3, height=3.3, dpi=600)

plot.path_probe <- plot.path_probe + theme(legend.position="none")
ggsave("../WP10_data/Plots/path_probe.jpg", plot.path_probe, width=3, height=3.3, dpi=600)

plot.distance_probe <- plot.distance_probe + theme(legend.position="none")
ggsave("../WP10_data/Plots/distance_probe.jpg", plot.distance_probe, width=3, height=3.3, dpi=600)

plot.initial_rotation_probe <- plot.initial_rotation_probe + theme(legend.position="none")
ggsave("../WP10_data/Plots/initial_rotation_probe.jpg", plot.initial_rotation_probe, width=3, height=3.3, dpi=600)

rm(plot.latency_probe, plot.path_probe, plot.distance_probe, plot.initial_rotation_probe)
```

---
title: "Preliminary Descriptives & Plots of Starmaze Data"
author: "Patrizia Maier"
date: "`r format(Sys.time(), '%d %B, %Y')`"
output: pdf_document
---

### Task

Navigating a star-shaped maze environment ("Starmaze") with three goal locations.

![Map of the environment](./pics/Starmaze_Environment.jpg){width=400px}

### Sessions

*Day 1*

* Practise trials, including joystick control practise (2 trials) and task explanation (5 trials).
* Navigation to and remembering of the position of three goal locations. Baseline retrieval in egocentric (observer-dependent, i.e. from same starting point but without landmark cues) and allocentric (observer-independent, i.e. from new starting points) condition (15 trials per goal location; 45 in total).

*Day 13*

* Consolidated retrieval in egocentric and allocentric condition (5 trials per goal location; 15 in total).
* Non-navigational memory retrieval: Recognize maze shape, recognize landmarks and goal objects, reconstruct location of landmarks and goal object (4 trials in total).


![Trial order at Day 1 (45 trials)](./pics/Overview_Session1.jpg){width=500px}

![Trial order at Day 13 (15 trials)](./pics/Overview_Session2.jpg){width=500px}

![Non-navigational memory retrieval at Day 13 (4 trials)](./pics/Overview_Session2_PostTest.jpg){width=500px}


```{r setup, include = FALSE, cache=FALSE}

library(tidyverse)
library(patchwork)
library(kableExtra)
source("R_rainclouds.R") # requires plyr package
# install.packages('tinytex')
# tinytex::install_tinytex() # latex for pdf file creation

knitr::read_chunk('Script_02_Table_Plot_Creator.R')
```


```{r, load_data, include=FALSE}
in_file <- "../WP10_data/WP10_results/WP10_results_table.RData"
load(in_file)
rm(in_file)
```

```{r, prepare_data, include=FALSE}

sm_trial_data <- sm_trial_data[sm_trial_data$exclude_trial_matlab==0,]

```


### Current sample
Cross-sectional comparison between

* Young kids (6-7 yrs, n = `r length(unique(sm_trial_data$id[sm_trial_data$group=="YoungKids"]))`) 
* Older kids (9-10 yrs, n = `r length(unique(sm_trial_data$id[sm_trial_data$group=="OldKids"]))`)
* Young adults (18-35 yrs, n = `r length(unique(sm_trial_data$id[sm_trial_data$group=="YoungAdults"]))`)
* Older adults (68-75 yrs, n = `r length(unique(sm_trial_data$id[sm_trial_data$group=="OldAdults"]))`)


### How long did the sessions take on average?

```{r, session_duration, include=FALSE}

temp <- sm_trial_data %>% group_by(session, group) %>%
  summarize(mean=mean(session_duration, na.rm = T))

```

*Young kids*: 

* Day 1: `r round(temp$mean[temp$session==3 & temp$group=="YoungKids"])` min for practise, `r round(temp$mean[temp$session==1 & temp$group=="YoungKids"])` min for learning
* Day 13: `r round(temp$mean[temp$session==2 & temp$group=="YoungKids"])` min for retrieval, x min for non-navigational tests

*Older kids*: 

* Day 1: `r round(temp$mean[temp$session==3 & temp$group=="OldKids"])` min for practise, `r round(temp$mean[temp$session==1 & temp$group=="OldKids"])` min for learning
* Day 13: `r round(temp$mean[temp$session==2 & temp$group=="OldKids"])` min for retrieval, x min for non-navigational tests


### Variables of interest

In learning trials, the goal is visible, i.e. the trial is always completed successfully except if the participant needs more than 120 seconds (time out). In egocentric and allocentric retrieval trials, the goal is not visible. Participants go to the place where they remember the goal being located and press a button. 

* **correct_goal** (yes/no): Finding the correct goal location. The criterion for success is being away less than 0.1 virtual units (~ approx. being in the correct alley).
* **Direct path** (yes/no): Being successful and additionally taking the shortest path without entering any additional alleys.
* **Final distance** (metric): Distance between x-/y-coordinates of the chosen and the correct goal location. 
$$FD = \sqrt{(x_{correct}-x_{chosen})^2 + (y_{correct}-y_{chosen})^2}$$
* **Path** (metric): Absolute length of traveled path to chosen goal location. Calculated as summation of distance between x-/y-coordinates over time. Plots include only paths to correct goal locations (successful). 
$$P = \sum \sqrt{(x_{t}-x_{t+1})^2 + (y_{t}-y_{t+1})^2}$$
* **Strategy classification**: Direct strategy to chosen goal (no detours), central focus (circling in inner pentagon), reorientation (going back same path), serial, random or unclassified strategy. 


``` {r, plot_settings, include=FALSE}
```

``` {r, func_mean, include=FALSE}
```


### Memory encoding: Learning curves at Day 1 

How well did participants learn the position of the three goal locations at Day 1? Young adults show a very good performance (at ceiling) after only a few trials. Old kids perform slightly worse. Even though they are able to find the correct goal location in most cases (high rate of success), they do not seem to take the most direct path and have more difficulties when determining the precise location of the goals. As expected, young kids perform even worse (caution: 1 subject only). Learning curves are averaged across blocks, i.e. the mean value across three goal locations. 

``` {r, data_func_all_trials, include=FALSE}
```

``` {r, trial_wise_s1, echo=FALSE, warning=FALSE, fig.width=8, fig.height=10, fig.align="center" }

p1 + p2 + plot_annotation(title="Initial learning and recall", tag_levels = 'A') +
  plot_layout(ncol=1, guides="collect") & theme(legend.position = "top",
                                                legend.justification=c(0,0))

```
\newpage 

``` {r, func_agg, include=FALSE}
```

``` {r, data_agg_s1, include=FALSE}
```

``` {r, agg_s1, echo=FALSE, warning=FALSE, fig.width=10, fig.align="center"  }

p1 + p2 + p3 + p4 + plot_annotation(title="Averaged values during learning in session 1",
                               subtitle="learning trials only (correct goal is visible)",
                               tag_levels = 'A') +
  plot_layout(ncol=4, guides="collect") & theme(legend.position = "bottom",
                                                legend.justification=c(0,0))

```


### Immediate (Day 1) vs. consolidated retrieval (Day 13): Egocentric and allocentric condition 

*First plot:* As expected, the preliminary results show age-related performance differences, i.e. a better performance with higher age. So far, we have not collected any data from older adults, so we do not know if the effect reverses with older age. The age-dependent performance trajectory is present in all conditions, i.e. in both allocentric and egocentric trials and during immediate retrieval at Day 1 as well as consolidated retrieval at Day 13. Notably, performance variability seems to be higher in old kids compared to young adults, i.e. some old kids perform like adults whereas others struggle much more. We can potentially take a closer look at the reasons behind this variability with the structural MR data in the B04 project in Berlin (start in 2021). When looking at the difference between Day 13 and Day 1 (forgetting rate) older kids tend to have a higher decline in success compared to younger adults, but a comparable decline in remembering the direct path. 

*Second plot:* When comparing allocentric vs. egocentric trials directly, the performance level is  similar, indicating a relatively comparable task difficulty. Only for the ability to remember the direct path, both old kids and younger adults show higher performance in egocentric compared to allocentric condition.



``` {r, agg_s2_s1, echo=FALSE, warning=FALSE, fig.width=10, fig.height=6, fig.align="center" }

p11 + p12 + p13 + p14 + 
  plot_annotation(title="Averaged values during free recall in session 1",
                  subtitle="egocentric and allocentric trials only (goal invisible)",
                  tag_levels = 'A') +
  plot_layout(ncol=2, guides="collect") & theme(legend.position = "bottom",
                                                legend.justification=c(0,0)) 

```

``` {r, data_agg_s2_s1, include=FALSE }

```

``` {r, agg_diff_s2_s1, echo=FALSE, warning=FALSE, fig.width=8, fig.height=4, fig.align="center"}

p1a + p1b + plot_annotation(title="", tag_levels = 'A') + 
  plot_layout(widths = c(2,1))

```
\newpage 

``` {r, data_func_rain, include=FALSE }

```

``` {r, rain_s2_s1, echo=FALSE, warning=FALSE, fig.width=10, fig.height=6, fig.align="center" }

r1 + p1b + 
  plot_annotation(title="", tag_levels = 'A') + 
  plot_layout(ncol=2, widths=c(3,1)) & theme(legend.justification=c(0,0))

```

### Strategy use data 

I categorized participant's trajectories into strategies. Strategies are a qualitative description of the trajectory and independent of performance. For example, direct strategy means that the participant went straight to the chosen goal location without any detours or reorienting, independent of whether the chosen goal location was correct or incorrect. 

*Criteria for strategy assignment*:

* **Direct**: Shortest path to chosen goal location without re-entry of zones. Not necessarily correct goal location. 
* **Detour**: Non-direct path without re-entry of zones to chosen goal location. 
* **Reoriented**: Non-direct path with re-entry of zones to chosen goal location. 

![Examples for strategies](./pics/Overview_Strategies.jpg){width=400px}

*Plots on next page:* Most young adults go straight to their chosen goal (direct strategy), indicating relatively high confidence in their decision. While old kids show a similar preference, they reorient and spend time in the central circle in some trials as well, especially on Day 13. Serial strategy, random or unclassified behavior is rarely present in all groups. When looking at conditions separately, we see that non-direct strategies are used in allocentric but not in egocentric trials. This makes sense because there are no landmarks present in egocentric trials (except for a start marker), so there are not many distinctive features for (re-)orientation. 

``` {r, data_func_strategy, include=FALSE}
```

``` {r, agg_strategy, echo=FALSE, fig.height=8, fig.width=10, fig.align="center" }

s1 + plot_spacer() + s2 + s3 + plot_layout(ncol=2) + 
  plot_annotation(title= "Strategy use in %", tag_levels = 'A')

```
\newpage 


### Motor Control Task 

![Motor control practise task](./pics/Motor_Control.jpg){width=600px}

``` {r, data_func_motor_control, include=FALSE}
```

``` {r, motor_control, echo=FALSE, warning=FALSE, fig.width=10, fig.height=5, fig.align="center" }

mc1 + mc2 + mc3 + 
  plot_annotation(title="Motor control practise trial",
                  subtitle="Task: To navigate to 10 red balls as quickly and efficiently as possible", 
                  tag_levels = 'A') 

```
\newpage 


### Table with descriptive mean values

<!-- # ``` {r, table_setup, echo=FALSE, message=FALSE } -->
<!-- # -->
<!-- # table_dat <- sm_trial_data %>% -->
<!-- #   group_by(group, session, trial_condition)  %>% -->
<!-- #   summarise(correct_goal=mean(correct_goal), -->
<!-- #             direct_path=mean(direct_path), -->
<!-- #             final_distance=mean(final_distance)) -->
<!-- # -->
<!-- # ``` -->

<!-- # ``` {r, table_learn, echo=FALSE, message=FALSE, warning=FALSE, results='asis' } -->
<!-- #  -->
<!-- # table_dat  %>% -->
<!-- #   filter(trial_condition=="main_learn")  %>%  -->
<!-- #   select(group, correct_goal, direct_path, final_distance) %>% -->
<!-- #   arrange(group) %>% -->
<!-- #   kbl(format="pandoc", -->
<!-- #       caption = "Mean values for learning trials", -->
<!-- #       col.names = c("Session", "Group", "% Correct goal", "% Shortest path", "Final distance"), -->
<!-- #       digits = 2) %>%  -->
<!-- #   kable_classic(html_font = "Latin Modern") %>%  -->
<!-- #   row_spec(0, bold=T) %>% -->
<!-- #   add_header_above(bold=T, c(" " = 2, "Variables" = 4)) -->
<!-- #  -->
<!-- # ``` -->

<!-- # ``` {r, table_alloego, echo=FALSE, message=FALSE, warning=FALSE, results='asis' } -->
<!-- #  -->
<!-- # table_dat  %>% -->
<!-- #   filter((trial_condition=="ego_ret" | trial_condition=="allo_ret"))  %>%  -->
<!-- #   mutate(trial_condition=if_else(trial_condition=="allo_ret", "Allocentric", "Egocentric")) %>% -->
<!-- #   select(trial_condition, session, group, correct_goal, direct_path, final_distance) %>% -->
<!-- #   arrange(trial_condition, session, group) %>%  -->
<!-- #   kbl(format="pandoc", -->
<!-- #       caption = "Mean values for allocentric and egocentric trials",  -->
<!-- #       col.names = c("Type", "Session", "Group", "% Correct goal", "% Shortest path", "Final distance", "Path"), -->
<!-- #       digits = 2)%>%  -->
<!-- #   kable_classic(html_font = "Latin Modern") %>%  -->
<!-- #   row_spec(0, bold=T) %>%  -->
<!-- #   collapse_rows(columns = 1:3, valign = "top") %>% -->
<!-- #   add_header_above(bold=T, c(" " = 3, "Variables" = 4)) -->
<!-- #  -->
<!-- # ``` -->
